{"version":3,"sources":["../node_modules/tslib/tslib.es6.js","../../../projects/ng2-ui-auth/src/lib/utils.ts","../../../projects/ng2-ui-auth/src/lib/storage-type.enum.ts","../../../projects/ng2-ui-auth/src/lib/config-providers.ts","../../../projects/ng2-ui-auth/src/lib/config.service.ts","../../../projects/ng2-ui-auth/src/lib/storage-service.ts","../../../projects/ng2-ui-auth/src/lib/browser-storage.service.ts","../../../projects/ng2-ui-auth/src/lib/shared.service.ts","../../../projects/ng2-ui-auth/src/lib/interceptor.service.ts","../../../projects/ng2-ui-auth/src/lib/popup.service.ts","../../../projects/ng2-ui-auth/src/lib/local.service.ts","../../../projects/ng2-ui-auth/src/lib/auth.service.ts","../../../projects/ng2-ui-auth/src/lib/redirect.service.ts","../../../projects/ng2-ui-auth/src/lib/oauth1.service.ts","../../../projects/ng2-ui-auth/src/lib/oauth2.service.ts","../../../projects/ng2-ui-auth/src/lib/oauth.service.ts","../../../projects/ng2-ui-auth/src/lib/redirect.directive.ts","../../../projects/ng2-ui-auth/src/lib/ng2-ui-auth.module.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","create","__read","o","n","m","Symbol","iterator","r","e","i","ar","next","done","push","value","error","__spread","arguments","length","concat","joinUrl","baseUrl","url","test","join","replace","buildQueryString","obj","keys","map","key","encodeURIComponent","getWindowOrigin","w","window","location","origin","protocol","hostname","port","parseQueryString","joinedKeyValue","split","reduce","keyValue","decodeURIComponent","expand","out","indexOf","substring","filter","index","array","forEach","childObject_1","k","startsWith","substr","isCordovaApp","cordova","document","URL","StorageType","defaultProviders","facebook","name","redirectUri","authorizationEndpoint","additionalUrlParams","display","scope","scopeDelimiter","oauthType","popupOptions","width","height","google","prompt","undefined","login_hint","access_type","include_granted_scopes","openid.realm","hd","state","Math","random","toString","github","instagram","linkedin","twitter","twitch","live","yahoo","bitbucket","spotify","CONFIG_OPTIONS","InjectionToken","ConfigService","options","this","withCredentials","tokenRoot","loginUrl","signupUrl","unlinkUrl","tokenName","tokenSeparator","tokenPrefix","authHeader","authToken","storageType","LOCAL_STORAGE","resolveToken","response","config","accessToken","access_token","token","data","tokenRootData","x","providers","assign","mergeWithDefaultProviders","updateProviders","_this","Injectable","Inject","args","BrowserStorageService","_super","store","MEMORY","updateStorageType","console","warn","__","constructor","__extends","checkIsStorageAvailable","get","COOKIE","SESSION_COOKIE","getCookie","SESSION_STORAGE","getItem","NONE","set","date","setCookie","setItem","remove","removeCookie","removeItem","isCookieStorageAvailable","isWindowStorageAvailable","supported","Date","now","toUTCString","expires","path","cookie","RegExp","StorageService","SharedService","storage","getToken","getPayload","base64","JSON","parse","b64DecodeUnicode","setToken","expDate","getExpirationDate","removeToken","isAuthenticated","exp","round","getTime","payload","setUTCSeconds","logout","Observable","observer","complete","setStorageType","type","str","atob","c","charCodeAt","slice","JwtInterceptor","shared","intercept","req","_b","newReq","headers","has","clone","setHeaders","_a","handle","PopupService","open","isCordova","stringifiedOptions","stringifyOptions","prepareOptions","windowName","popupWindow","focus","of","throwError","Error","waitForClose","eventListener","pollPopup","merge","fromEvent","pipe","delay","switchMap","event","closed","throw","EMPTY","parser","createElement","href","search","hash","queryParams","qs","allParams","close","take","interval","popupWindowOrigin","left","screenX","outerWidth","top","screenY","outerHeight","toolbar","visibleToolbar","LocalService","http","login","user","post","tap","signup","HttpClient","AuthService","local","oauth","authenticate","userData","link","unlink","provider","OauthService","RedirectService","authService","go","authorizationData","flatten","subobj_1","subkey","staticify","tmpObj","tmp","isRedirect","windowOrigin","handleRedirect","optionsObject","getProvider","exchangeForToken","Oauth1Service","popup","redirect","oauthOptions","serverUrl","doRedirect","mergeMap","oauthData","body","method","exchangeForTokenUrl","request","Oauth2Service","getAuthorizationData","responseType","clientId","_c","resolvedState","_","acc","depProviders","provide","useValue","deps","id","Injector","RedirectDirective","onLogin","EventEmitter","onLoginError","ngOnInit","subscribe","emit","err","Directive","selector","Output","Ng2UiAuthModule","forRoot","configOptions","defaultJwtInterceptor","ngModule","useClass","HTTP_INTERCEPTORS","multi","NgModule","imports","HttpClientModule","declarations","exports"],"mappings":";;;;;;;;;;;;;;oFAgBA,IAAIA,EAAgB,SAASC,EAAGC,GAI5B,OAHAF,EAAgBG,OAAOC,gBAClB,CAAEC,UAAW,cAAgBC,OAAS,SAAUL,EAAGC,GAAKD,EAAEI,UAAYH,IACvE,SAAUD,EAAGC,GAAK,IAAK,IAAIK,KAAKL,EAAOC,OAAOK,UAAUC,eAAeC,KAAKR,EAAGK,KAAIN,EAAEM,GAAKL,EAAEK,MAC3EN,EAAGC,IAqFCC,OAAOQ,gBAwBpBC,EAAOC,EAAGC,GACtB,IAAIC,EAAsB,mBAAXC,QAAyBH,EAAEG,OAAOC,UACjD,IAAKF,EAAG,OAAOF,EACf,IAAmBK,EAAYC,EAA3BC,EAAIL,EAAEL,KAAKG,GAAOQ,EAAK,GAC3B,IACI,WAAc,IAANP,GAAgBA,KAAM,MAAQI,EAAIE,EAAEE,QAAQC,MAAMF,EAAGG,KAAKN,EAAEO,OAExE,MAAOC,GAASP,EAAI,CAAEO,MAAOA,WAEzB,IACQR,IAAMA,EAAEK,OAASR,EAAIK,EAAU,SAAIL,EAAEL,KAAKU,WAExC,GAAID,EAAG,MAAMA,EAAEO,OAE7B,OAAOL,WAGKM,IACZ,IAAK,IAAIN,EAAK,GAAID,EAAI,EAAGA,EAAIQ,UAAUC,OAAQT,IAC3CC,EAAKA,EAAGS,OAAOlB,EAAOgB,UAAUR,KACpC,OAAOC,EA8CclB,OAAOQ,gBC5LhBoB,EAAQC,EAAiBC,GACvC,MAAI,qBAAqBC,KAAKD,GACrBA,EAGM,CAACD,EAASC,GAAKE,KAAK,KAGhCC,QAAQ,SAAU,KAClBA,QAAQ,QAAS,KACjBA,QAAQ,QAAS,KACjBA,QAAQ,QAAS,gBAGNC,EAAiBC,GAC/B,OAAOnC,OAAOoC,KAAKD,GAChBE,KAAI,SAAAC,GAAO,OAAGH,EAAIG,GAAUC,mBAAmBD,GAAI,IAAIC,mBAAmBJ,EAAIG,IAAUA,KACxFN,KAAK,cAGMQ,EAAgBC,GACzBA,GAAuB,oBAAXC,SACfD,EAAIC,QAEN,IACE,OAAKD,GAAMA,EAAEE,SAGRF,EAAEE,SAASC,OAGTH,EAAEE,SAASC,OAFNH,EAAEE,SAASE,SAAQ,KAAKJ,EAAEE,SAASG,UAAWL,EAAEE,SAASI,KAAO,IAAMN,EAAEE,SAASI,KAAO,IAH3F,KAMT,MAAOxB,GACP,OAAO,eAaKyB,EAAiBC,GAC/B,IACI3B,EACJ,OAAO2B,EAAeC,MAAM,KAAKC,QAC/B,SAAChB,EAAKiB,GAMJ,OALIA,IACF9B,EAAQ8B,EAASF,MAAM,KAEvBf,EADMkB,mBAAmB/B,EAAM,UACA,IAAbA,EAAM,IAAqB+B,mBAAmB/B,EAAM,KAEjEa,IAET,aAiBYmB,EAAOnB,GACrB,IAAMoB,EAAM,GAeZ,OAdcvD,OAAOoC,KAAKD,GACvBE,KAAI,SAAAC,GAAO,OAAAA,EAAIkB,QAAQ,MAAQ,EAAIlB,EAAImB,UAAU,EAAGnB,EAAIkB,QAAQ,MAAQlB,KACxEoB,QAAO,SAACpC,EAAOqC,EAAOC,GAAU,OAAAA,EAAMJ,QAAQlC,KAAWqC,KACtDE,SAAQ,SAAAvB,GACZ,GAAIH,EAAIG,GACNiB,EAAIjB,GAAOH,EAAIG,OACV,CACL,IAAMwB,EAAc,GACpB9D,OAAOoC,KAAKD,GAAKuB,QAAO,SAAAK,GAAK,OAAAA,EAAEC,WAAW1B,EAAM,QAAMuB,SAAQ,SAAAE,GAC5DD,EAAYC,EAAEE,OAAO3B,EAAIZ,OAAS,IAAMS,EAAI4B,MAE9CR,EAAIjB,GAAOgB,EAAOQ,OAGfP,WA2BOW,IACd,MAA0B,iBAAZC,UAA8D,IAArCC,SAASC,IAAIb,QAAQ,aAA2D,IAAtCY,SAASC,IAAIb,QAAQ,gBC9H5Fc,ECGCC,EAA+B,CAC1CC,SAAU,CACRC,KAAM,WACN3C,IAAK,iBACL4C,YAAgBlC,IAAiB,IACjCmC,sBAAuB,6CACvBC,oBAAqB,CACnBC,QAAS,SAEXC,MAAO,CAAC,SACRC,eAAgB,IAChBC,UAAW,MACXC,aAAc,CAAEC,MAAO,IAAKC,OAAQ,MAEtCC,OAAQ,CACNX,KAAM,SACN3C,IAAK,eACL6C,sBAAuB,+CACvBC,oBAAqB,CACnBC,QAAS,QACTQ,YAAQC,EACRC,gBAAYD,EACZE,iBAAaF,EACbG,4BAAwBH,EACxBI,oBAAgBJ,EAChBK,QAAIL,GAENR,MAAO,CAAC,SAAU,SAClBC,eAAgB,IAChBC,UAAW,MACXC,aAAc,CAAEC,MAAO,IAAKC,OAAQ,KACpCS,MAAO,WACL,OAAArD,mBACEsD,KAAKC,SACFC,SAAS,IACT9B,OAAO,MAGhB+B,OAAQ,CACNvB,KAAM,SACN3C,IAAK,eACL6C,sBAAuB,2CACvBG,MAAO,CAAC,cACRC,eAAgB,IAChBC,UAAW,MACXC,aAAc,CAAEC,MAAO,KAAMC,OAAQ,MAEvCc,UAAW,CACTxB,KAAM,YACN3C,IAAK,kBACL6C,sBAAuB,4CACvBG,MAAO,CAAC,SACRC,eAAgB,IAChBC,UAAW,OAEbkB,SAAU,CACRzB,KAAM,WACN3C,IAAK,iBACL6C,sBAAuB,oDACvBG,MAAO,CAAC,kBACRC,eAAgB,IAChBC,UAAW,MACXC,aAAc,CAAEC,MAAO,IAAKC,OAAQ,KACpCS,MAAO,SAETO,QAAS,CACP1B,KAAM,UACN3C,IAAK,gBACL6C,sBAAuB,6CACvBK,UAAW,MACXC,aAAc,CAAEC,MAAO,IAAKC,OAAQ,MAEtCiB,OAAQ,CACN3B,KAAM,SACN3C,IAAK,eACL6C,sBAAuB,gDACvBG,MAAO,CAAC,aACRC,eAAgB,IAChBH,oBAAqB,CACnBC,QAAS,SAEXG,UAAW,MACXC,aAAc,CAAEC,MAAO,IAAKC,OAAQ,MAEtCkB,KAAM,CACJ5B,KAAM,OACN3C,IAAK,aACL6C,sBAAuB,+CACvBC,oBAAqB,CACnBC,QAAS,SAEXC,MAAO,CAAC,aACRC,eAAgB,IAChBC,UAAW,MACXC,aAAc,CAAEC,MAAO,IAAKC,OAAQ,MAEtCmB,MAAO,CACL7B,KAAM,QACN3C,IAAK,cACL6C,sBAAuB,kDACvBG,MAAO,GACPC,eAAgB,IAChBC,UAAW,MACXC,aAAc,CAAEC,MAAO,IAAKC,OAAQ,MAEtCoB,UAAW,CACT9B,KAAM,YACN3C,IAAK,kBACL6C,sBAAuB,8CACvBD,YAAgBlC,IAAiB,IACjCsC,MAAO,CAAC,SACRC,eAAgB,IAChBC,UAAW,MACXC,aAAc,CAAEC,MAAO,KAAMC,OAAQ,MAEvCqB,QAAS,CACP/B,KAAM,UACN3C,IAAK,gBACL6C,sBAAuB,yCACvBG,MAAO,CAAC,GAAI,mBACZC,eAAgB,IAChBC,UAAW,MACXC,aAAc,CAAEC,MAAO,IAAKC,OAAQ,KACpCS,MAAO,WACL,OAAArD,mBACEsD,KAAKC,SACFC,SAAS,IACT9B,OAAO,QDlINK,EAAAA,EAAAA,cAAAA,EAAAA,YAAW,KACrB,KAAA,OACAA,EAAA,OAAA,SACAA,EAAA,cAAA,eACAA,EAAA,gBAAA,iBACAA,EAAA,OAAA,SACAA,EAAA,eAAA,oBEDWmC,EAAiB,IAAIC,EAAAA,eAAoB,+BA+CpD,SAAAC,EAAoCC,GA5C7BC,KAAAD,QAAU,CACfE,iBAAiB,EACjBC,UAAW,KACXlF,QAAS,IACTmF,SAAU,cACVC,UAAW,eACXC,UAAW,gBACXC,UAAW,QACXC,eAAgB,IAChBC,YAAa,cACbC,WAAY,gBACZC,UAAW,SACXC,YAAalD,EAAAA,YAAYmD,cACzBtD,aAASmB,EACToC,aAAc,SAACC,EAAeC,GAC5B,IAAMC,EACJF,IAAaA,EAASG,cAAgBH,EAASI,OAASJ,EAASK,MACnE,IAAKH,EAEH,OAAO,KAET,GAA2B,iBAAhBA,EACT,OAAOA,EAET,GAA2B,iBAAhBA,EAET,OAAO,KAET,IAAMI,EACJL,EAAOb,WACPa,EAAOb,UAAU7D,MAAM,KAAKC,QAAO,SAACzC,EAAQwH,GAC1C,OAAOxH,EAAEwH,KACRL,GACCE,EAAQE,EAAgBA,EAAcL,EAAOT,WAAaU,EAAYD,EAAOT,WACnF,OAAIY,GAKG,MAETI,UAAW,IAIXtB,KAAKD,QAAO5G,OAAAoI,OAAApI,OAAAoI,OAAA,GACPvB,KAAKD,SACLA,GAELC,KAAKwB,mCAGP1B,EAAAtG,UAAAiI,gBAAA,SAAgBH,GACdtB,KAAKD,QAAQuB,UAASnI,OAAAoI,OAAApI,OAAAoI,OAAA,GAChBvB,KAAKD,QAAQuB,WAAa,IAC3BA,GAELtB,KAAKwB,6BAGP1B,EAAAtG,UAAAgI,0BAAA,WAAA,IAAAE,EAAA1B,KACE7G,OAAOoC,KAAKyE,KAAKD,QAAQuB,WAAWtE,SAAQ,SAAAvB,GACtCA,KAAOiC,IACTgE,EAAK3B,QAAQuB,UAAU7F,GAAItC,OAAAoI,OAAApI,OAAAoI,OAAA,GACtB7D,EAAiBjC,IACjBiG,EAAK3B,QAAQuB,UAAU7F,kCAnEnCkG,EAAAA,+EA8CcC,EAAAA,OAAMC,KAAA,CAACjC,cClDtB,2BCQE,SAAAkC,EAAoBf,GAApB,IAAAW,EACEK,EAAArI,KAAAsG,OAAOA,YADW0B,EAAAX,OAAAA,EAHZW,EAAAM,MAAmC,GACnCN,EAAAf,YAAclD,EAAAA,YAAYwE,OAI3BP,EAAKQ,kBAAkBnB,EAAOhB,QAAQY,cACzCwB,QAAQC,KAAKrB,EAAOhB,QAAQY,YAAc,wCNUtB1H,EAAGC,GAEzB,SAASmJ,IAAOrC,KAAKsC,YAAcrJ,EADnCD,EAAcC,EAAGC,GAEjBD,EAAEO,UAAkB,OAANN,EAAaC,OAAOQ,OAAOT,IAAMmJ,EAAG7I,UAAYN,EAAEM,UAAW,IAAI6I,GMpBxCE,CAAAT,EAAAC,GAWlCD,EAAAtI,UAAA0I,kBAAA,SAAkBvB,GAEvB,QAD2BX,KAAKwC,wBAAwB7B,KAIxDX,KAAKW,YAAcA,GACZ,IAGFmB,EAAAtI,UAAAiJ,IAAA,SAAIhH,GACT,OAAQuE,KAAKW,aACX,KAAKlD,EAAAA,YAAYiF,OACjB,KAAKjF,EAAAA,YAAYkF,eACf,OAAO3C,KAAK4C,UAAUnH,GACxB,KAAKgC,EAAAA,YAAYmD,cACjB,KAAKnD,EAAAA,YAAYoF,gBACf,OAAOhH,OAAOmE,KAAKW,aAAamC,QAAQrH,GAC1C,KAAKgC,EAAAA,YAAYwE,OACf,OAAOjC,KAAKgC,MAAMvG,GACpB,KAAKgC,EAAAA,YAAYsF,KACjB,QACE,OAAO,OAINjB,EAAAtI,UAAAwJ,IAAA,SAAIvH,EAAahB,EAAewI,GACrC,OAAQjD,KAAKW,aACX,KAAKlD,EAAAA,YAAYiF,OACjB,KAAKjF,EAAAA,YAAYkF,eACf3C,KAAKkD,UAAUzH,EAAKhB,EAAOuF,KAAKW,cAAgBlD,EAAAA,YAAYiF,OAASO,EAAO,IAC5E,MACF,KAAKxF,EAAAA,YAAYmD,cACjB,KAAKnD,EAAAA,YAAYoF,gBACfhH,OAAOmE,KAAKW,aAAawC,QAAQ1H,EAAKhB,GACtC,MACF,KAAKgD,EAAAA,YAAYwE,OACfjC,KAAKgC,MAAMvG,GAAOhB,EAClB,MACF,KAAKgD,EAAAA,YAAYsF,QAMdjB,EAAAtI,UAAA4J,OAAA,SAAO3H,GACZ,OAAQuE,KAAKW,aACX,KAAKlD,EAAAA,YAAYiF,OACjB,KAAKjF,EAAAA,YAAYkF,eACf3C,KAAKqD,aAAa5H,GAClB,MACF,KAAKgC,EAAAA,YAAYmD,cACjB,KAAKnD,EAAAA,YAAYoF,gBACfhH,OAAOmE,KAAKW,aAAa2C,WAAW7H,GACpC,MACF,KAAKgC,EAAAA,YAAYwE,cACRjC,KAAKgC,MAAMvG,GAClB,MACF,KAAKgC,EAAAA,YAAYsF,QAMbjB,EAAAtI,UAAAgJ,wBAAA,SAAwB7B,GAC9B,OAAQA,GACN,KAAKlD,EAAAA,YAAYiF,OACjB,KAAKjF,EAAAA,YAAYkF,eACf,OAAO3C,KAAKuD,2BACd,KAAK9F,EAAAA,YAAYmD,cACjB,KAAKnD,EAAAA,YAAYoF,gBACf,OAAO7C,KAAKwD,yBAAyB7C,GACvC,KAAKlD,EAAAA,YAAYsF,KACjB,KAAKtF,EAAAA,YAAYwE,OACf,OAAO,EACT,QACE,OAAO,IAILH,EAAAtI,UAAAgK,yBAAA,SAAyB7C,GAC/B,IACE,IAAM8C,EAAY5H,QAAU8E,KAAe9E,QAAkC,OAAxBA,OAAO8E,GAE5D,GAAI8C,EAAW,CACb,IAAMhI,EAAMuD,KAAKC,SACdC,SAAS,IACTtC,UAAU,GACbf,OAAO8E,GAAawC,QAAQ1H,EAAK,IACjCI,OAAO8E,GAAa2C,WAAW7H,GAGjC,OAAOgI,EACP,MAAOtJ,GACP,OAAO,IAIH2H,EAAAtI,UAAA+J,yBAAA,WACN,IAGE,GAFkBhG,UAAY,WAAYA,SAE3B,CACb,IAAM9B,EAAMuD,KAAKC,SACdC,SAAS,IACTtC,UAAU,GACboD,KAAKkD,UAAUzH,EAAK,OAAQ,IAAIiI,KAAKA,KAAKC,MAAQ,KAAWC,eAC7D,IAAMnJ,EAAQuF,KAAK4C,UAAUnH,GAE7B,OADAuE,KAAKqD,aAAa5H,GACD,SAAVhB,EAET,OAAO,EACP,MAAON,GACP,OAAO,IAIH2H,EAAAtI,UAAA0J,UAAA,SAAUzH,EAAahB,EAAeoJ,EAAcC,QAAd,IAAAD,IAAAA,EAAA,SAAc,IAAAC,IAAAA,EAAA,KAC1DvG,SAASwG,OAAYtI,EAAG,IAAIhB,GAAQoJ,EAAU,aAAaA,EAAY,IAAE,UAAUC,GAG7EhC,EAAAtI,UAAA6J,aAAA,SAAa5H,EAAaqI,QAAA,IAAAA,IAAAA,EAAA,KAChC9D,KAAKkD,UAAUzH,EAAK,GAAI,IAAIiI,KAAK,GAAGE,cAAeE,IAG7ChC,EAAAtI,UAAAoJ,UAAA,SAAUnH,GAChB,OAAO8B,SAASwG,OAAO3I,QAAQ,IAAI4I,OAAO,mBAAmBvI,EAAG,+BAAgC,UAxIzDwI,uBAD1CtC,EAAAA,sDAFQ7B,sBCSP,SAAAoE,EAAoBC,EAAiCpD,GAAjCf,KAAAmE,QAAAA,EAAiCnE,KAAAe,OAAAA,EAJ9Cf,KAAAM,UAAYN,KAAKe,OAAOhB,QAAQS,YACnC,CAACR,KAAKe,OAAOhB,QAAQS,YAAaR,KAAKe,OAAOhB,QAAQO,WAAWnF,KAAK6E,KAAKe,OAAOhB,QAAQQ,gBAC1FP,KAAKe,OAAOhB,QAAQO,iBAKjB4D,EAAA1K,UAAA4K,SAAA,WACL,OAAOpE,KAAKmE,QAAQ1B,IAAIzC,KAAKM,YAGxB4D,EAAA1K,UAAA6K,WAAA,SAAWnD,GAChB,QADgB,IAAAA,IAAAA,EAAQlB,KAAKoE,YACzBlD,GAAqC,IAA5BA,EAAM7E,MAAM,KAAKxB,OAC5B,IACE,IACMyJ,EADYpD,EAAM7E,MAAM,KAAK,GACVjB,QAAQ,KAAM,KAAKA,QAAQ,KAAM,KAC1D,OAAOmJ,KAAKC,MAAMxE,KAAKyE,iBAAiBH,IACxC,MAAOnK,GACP,SAKC+J,EAAA1K,UAAAkL,SAAA,SAAS5D,GAMd,IAAII,EALJ,GAAKJ,IAOHI,EADsB,iBAAbJ,EACDA,EAEAd,KAAKe,OAAOhB,QAAQc,aAAaC,EAAUd,KAAKe,OAAOhB,UAGtD,CACT,IAAM4E,EAAU3E,KAAK4E,kBAAkB1D,GACvClB,KAAKmE,QAAQnB,IAAIhD,KAAKM,UAAWY,EAAOyD,EAAUA,EAAQf,cAAgB,MAIvEM,EAAA1K,UAAAqL,YAAA,WACL7E,KAAKmE,QAAQf,OAAOpD,KAAKM,YAGpB4D,EAAA1K,UAAAsL,gBAAA,SAAgB5D,GAErB,QAFqB,IAAAA,IAAAA,EAAQlB,KAAKoE,YAE9BlD,EAAO,CAET,GAAgC,IAA5BA,EAAM7E,MAAM,KAAKxB,OAEnB,IACE,IACMyJ,EADYpD,EAAM7E,MAAM,KAAK,GACVjB,QAAQ,KAAM,KAAKA,QAAQ,KAAM,KACpD2J,EAAMR,KAAKC,MAAMxE,KAAKyE,iBAAiBH,IAASS,IAEtD,GAAIA,EAEF,QADkB/F,KAAKgG,OAAM,IAAItB,MAAOuB,UAAY,MAASF,KAG3D/E,KAAKmE,QAAQf,OAAOpD,KAAKM,YAClB,GAMX,MAAOnG,GAEP,OAAO,EAIX,OAAO,EAGT,OAAO,GAGF+J,EAAA1K,UAAAoL,kBAAA,SAAkB1D,QAAA,IAAAA,IAAAA,EAAQlB,KAAKoE,YACpC,IAAMc,EAAUlF,KAAKqE,WAAWnD,GAChC,GAAIgE,GAAWA,EAAQH,KAAO/F,KAAKgG,OAAM,IAAItB,MAAOuB,UAAY,KAAQC,EAAQH,IAAK,CACnF,IAAM9B,EAAO,IAAIS,KAAK,GAEtB,OADAT,EAAKkC,cAAcD,EAAQH,KACpB9B,EAET,OAAO,MAGFiB,EAAA1K,UAAA4L,OAAA,WAAA,IAAA1D,EAAA1B,KACL,OAAO,IAAIqF,EAAAA,YAAgB,SAACC,GAC1B5D,EAAKyC,QAAQf,OAAO1B,EAAKpB,WACzBgF,EAAShL,OACTgL,EAASC,eAINrB,EAAA1K,UAAAgM,eAAA,SAAeC,GACpB,OAAOzF,KAAKmE,QAAQjC,kBAAkBuD,IAGhCvB,EAAA1K,UAAAiL,iBAAA,SAAiBiB,GACvB,OAAOlJ,mBAAmBlD,MAAME,UAAUgC,IACvC9B,KAAKiM,KAAKD,IAAM,SAAAE,GAAK,MAAA,KAAO,KAAOA,EAAEC,WAAW,GAAG3G,SAAS,KAAK4G,OAAO,MACxE3K,KAAK,+BA3GXwG,EAAAA,sDAHOsC,SACAnE,sBCIN,SAAAiG,EAAoBC,EAA+BjF,GAA/Bf,KAAAgG,OAAAA,EAA+BhG,KAAAe,OAAAA,SAEnDgF,EAAAvM,UAAAyM,UAAA,SAAUC,EAAuB5L,SACzB6L,EAA4BnG,KAAKe,OAAOhB,QAAtCU,EAAU0F,EAAA1F,WAAEC,EAASyF,EAAAzF,UACvBQ,EAAQlB,KAAKgG,OAAO5B,WAEpBgC,EADkBpG,KAAKgG,OAAOlB,oBAEdoB,EAAIG,QAAQC,IAAI7F,GAAcyF,EAAIK,MAAM,CAAEC,YAAUC,EAAA,GAAIA,EAAChG,GAAgBC,EAAS,IAAIQ,EAAOuF,KAAQP,EAC3H,OAAO5L,EAAKoM,OAAON,6BAVtBzE,EAAAA,sDAJQuC,SACApE,sBCKT,SAAA6G,YACSA,EAAAnN,UAAAoN,KAAA,SAAK3L,EAAa8E,EAA0C8G,QAAA,IAAAA,IAAAA,EAAYxJ,KAC7E,IAAMyJ,WRqCuB/G,GAC/B,OAAO5G,OAAOoC,KAAKwE,GAChBvE,KAAI,SAAAC,GAAO,OAAkB,OAAjBsE,EAAQtE,SAAkCgD,IAAjBsB,EAAQtE,GAAqBA,EAAMA,EAAM,IAAMsE,EAAQtE,MAC5FN,KAAK,KQxCqB4L,CAAiB/G,KAAKgH,eAAejH,EAAQ3B,eAClE6I,EAAaJ,EAAY,SAAW9G,EAAQnC,KAE5CsJ,EAAgC,oBAAXrL,OAAyBA,OAAO+K,KAAK3L,EAAKgM,EAAYH,GAAsB,KAEvG,OAAII,GACEA,EAAYC,OACdD,EAAYC,QAEPC,EAAAA,GAAGF,IAELG,EAAAA,WAAW,IAAIC,MAAM,2BAGvBX,EAAAnN,UAAA+N,aAAA,SAAaL,EAAqBL,EAA4BhJ,GACnE,YADuC,IAAAgJ,IAAAA,EAAYxJ,UAAgB,IAAAQ,IAAAA,EAAclC,KAC1EkL,EAAY7G,KAAKwH,cAAcN,EAAarJ,GAAemC,KAAKyH,UAAUP,EAAarJ,IAGxF8I,EAAAnN,UAAAgO,cAAA,SAAcN,EAAqBrJ,GACzC,YADyC,IAAAA,IAAAA,EAAclC,KAClDuL,EAGEQ,EAAAA,MACLC,EAAAA,UAAiBT,EAAa,QAAQU,KACpCC,EAAAA,MAAM,KACNrM,EAAAA,KAAI,WACF,MAAM,IAAI8L,MAAM,+BAGpBK,EAAAA,UAAUT,EAAa,cACvBU,KACAE,EAAAA,WAAU,SAACC,GACT,IAAKb,GAAeA,EAAYc,OAC9B,OAAO3C,EAAAA,WAAW4C,MAAM,IAAIX,MAAM,4BAEpC,GAAuC,IAAnCS,EAAM9M,IAAI0B,QAAQkB,GACpB,OAAOqK,EAAAA,MAGT,IAAMC,EAAS5K,SAAS6K,cAAc,KAGtC,GAFAD,EAAOE,KAAON,EAAM9M,IAEhBkN,EAAOG,QAAUH,EAAOI,KAAM,CAChC,IAAMC,EAAcL,EAAOG,OAAO1L,UAAU,GAAGxB,QAAQ,MAAO,IAExDmN,EAAOpM,EADMgM,EAAOI,KAAK3L,UAAU,GAAGxB,QAAQ,MAAO,KAErDqN,EAAKtM,EAAiBqM,GACtBE,EAASvP,OAAAoI,OAAApI,OAAAoI,OAAA,GAAOkH,GAAOF,GAI7B,GAFArB,EAAYyB,QAERD,EAAUhO,MACZ,MAAMgO,EAAUhO,MAEhB,OAAO0M,EAAAA,GAAGsB,GAGd,OAAOR,EAAAA,SAETU,EAAAA,KAAK,IAvCEvB,EAAAA,WAAW,IAAIC,MAAM,2BA2CxBX,EAAAnN,UAAAiO,UAAA,SAAUP,EAAqBrJ,GACrC,YADqC,IAAAA,IAAAA,EAAclC,KAC5CkN,EAAAA,SAAS,IAAIjB,KAClBE,EAAAA,WAAU,WACR,IAAKZ,GAAeA,EAAYc,OAC9B,OAAOX,EAAAA,WAAW,IAAIC,MAAM,4BAG9B,IAAMwB,EAAoBnN,EAAgBuL,GAE1C,GACE4B,IAC4C,IAA3CjL,EAAYlB,QAAQmM,IAAuE,IAA3CA,EAAkBnM,QAAQkB,MAC1EqJ,EAAYpL,SAASwM,QAAUpB,EAAYpL,SAASyM,MACrD,CACA,IAAMC,EAActB,EAAYpL,SAASwM,OAAO1L,UAAU,GAAGxB,QAAQ,MAAO,IAEtEmN,EAAOpM,EADM+K,EAAYpL,SAASyM,KAAK3L,UAAU,GAAGxB,QAAQ,QAAS,KAErEqN,EAAKtM,EAAiBqM,GAC5BtB,EAAYyB,QACZ,IAAMD,EAASvP,OAAAoI,OAAApI,OAAAoI,OAAA,GAAOkH,GAAOF,GAC7B,OAAIG,EAAUhO,MACL2M,EAAAA,WAAWqB,EAAUhO,OAErB0M,EAAAA,GAAGsB,GAGd,OAAOR,EAAAA,SAETU,EAAAA,KAAK,KAIDjC,EAAAnN,UAAAwN,eAAA,SAAejH,GAErB,IAAM1B,GADN0B,EAAUA,GAAW,IACC1B,OAAS,IACzBC,EAASyB,EAAQzB,QAAU,IACjC,OAAAnF,OAAAoI,OAAA,CACElD,MAAKA,EACLC,OAAMA,EACNyK,KAAMlN,OAAOmN,SAAWnN,OAAOoN,WAAa5K,GAAS,EACrD6K,IAAKrN,OAAOsN,SAAWtN,OAAOuN,YAAc9K,GAAU,IACtD+K,QAAStJ,EAAQuJ,eAAiB,MAAQ,MACvCvJ,6BA5GR4B,EAAAA,8BCIC,SAAA4H,EAAoBC,EAA0BxD,EAA+BjF,GAAzDf,KAAAwJ,KAAAA,EAA0BxJ,KAAAgG,OAAAA,EAA+BhG,KAAAe,OAAAA,SAGtEwI,EAAA/P,UAAAiQ,MAAA,SAAMC,EAAoCzO,GAA1C,IAAAyG,EAAA1B,KACL,OAAOA,KAAKwJ,KACTG,KAA0B1O,GAAOF,EAAQiF,KAAKe,OAAOhB,QAAQ/E,QAASgF,KAAKe,OAAOhB,QAAQI,UAAWuJ,GACrG9B,KAAKgC,EAAAA,KAAI,SAAAzI,GAAQ,OAAAO,EAAKsE,OAAOtB,SAASvD,QAGpCoI,EAAA/P,UAAAqQ,OAAA,SAAOH,EAAoCzO,GAChD,OAAO+E,KAAKwJ,KAAKG,KAA0B1O,GAAOF,EAAQiF,KAAKe,OAAOhB,QAAQ/E,QAASgF,KAAKe,OAAOhB,QAAQK,WAAYsJ,6BAZ1H/H,EAAAA,sDAROmI,EAAAA,kBACA5F,SACApE,sBCON,SAAAiK,EAAoB/D,EAA+BgE,EAA6BC,GAA5DjK,KAAAgG,OAAAA,EAA+BhG,KAAAgK,MAAAA,EAA6BhK,KAAAiK,MAAAA,SAGzEF,EAAAvQ,UAAAiQ,MAAA,SAAMC,EAAoCzO,GAC/C,OAAO+E,KAAKgK,MAAMP,MAAMC,EAAMzO,IAGzB8O,EAAAvQ,UAAAqQ,OAAA,SAAOH,EAAoCzO,GAChD,OAAO+E,KAAKgK,MAAMH,OAAOH,EAAMzO,IAG1B8O,EAAAvQ,UAAA4L,OAAA,WACL,OAAOpF,KAAKgG,OAAOZ,UAGd2E,EAAAvQ,UAAA0Q,aAAA,SAAatM,EAAcuM,GAChC,OAAOnK,KAAKiK,MAAMC,aAAatM,EAAMuM,IAGhCJ,EAAAvQ,UAAA4Q,KAAA,SAAKxM,EAAcuM,GACxB,OAAOnK,KAAKiK,MAAMC,aAAatM,EAAMuM,IAGhCJ,EAAAvQ,UAAA6Q,OAAA,SAAgBC,EAAkBrP,GACvC,OAAO+E,KAAKiK,MAAMI,OAAUC,EAAUrP,IAGjC8O,EAAAvQ,UAAAsL,gBAAA,WACL,OAAO9E,KAAKgG,OAAOlB,mBAGdiF,EAAAvQ,UAAA4K,SAAA,WACL,OAAOpE,KAAKgG,OAAO5B,YAGd2F,EAAAvQ,UAAAkL,SAAA,SAASxD,GACdlB,KAAKgG,OAAOtB,SAASxD,IAGhB6I,EAAAvQ,UAAAqL,YAAA,WACL7E,KAAKgG,OAAOnB,eAGPkF,EAAAvQ,UAAA6K,WAAA,WACL,OAAOrE,KAAKgG,OAAO3B,cAGd0F,EAAAvQ,UAAAgM,eAAA,SAAeC,GACpB,OAAOzF,KAAKgG,OAAOR,eAAeC,IAG7BsE,EAAAvQ,UAAAoL,kBAAA,WACL,OAAO5E,KAAKgG,OAAOpB,8CAtDtBjD,EAAAA,sDAJOuC,SAFAqF,SACAgB,sBCUN,SAAAC,EAAoBC,EAAkCtG,EAClC8F,EAA6BjE,GAD7BhG,KAAAyK,YAAAA,EAAkCzK,KAAAmE,QAAAA,EAClCnE,KAAAiK,MAAAA,EAA6BjK,KAAAgG,OAAAA,SAG1CwE,EAAAhR,UAAAkR,GAAA,SAAGzP,EAAa8E,EACb4K,EAAkCR,GAC1C,GAAItO,OAAQ,CACV,IAAM4M,EAAKpN,WXiDDuP,EAAQtP,GACtB,IAAMoB,EAAM,GASZ,OARAvD,OAAOoC,KAAKD,GAAK0B,SAAQ,SAAAvB,GACvB,GAA0B,iBAAdH,EAAIG,GAAoB,CAClC,IAAMoP,EAASD,EAAQtP,EAAIG,IAC3BtC,OAAOoC,KAAKsP,GAAQ7N,SAAQ,SAAA8N,GAAU,OAAApO,EAAIjB,EAAM,IAAMqP,GAAUD,EAAOC,WAEvEpO,EAAIjB,GAAOH,EAAIG,MAGZiB,EW3DyBkO,UXiFlBG,EAAUzP,GACxB,IAAMoB,EAAM,GAoBZ,OAnBAvD,OAAOoC,KAAKD,GAAK0B,SAAQ,SAAAvB,GACvB,cAAgBH,EAAIG,IAClB,IAAK,SACL,IAAK,SACL,IAAK,UACHiB,EAAIjB,GAAOH,EAAIG,GACf,MACF,IAAK,WACH,IAAMuP,EAASD,EAAU,CAACE,IAAM3P,EAAIG,OACpCiB,EAAIjB,GAAOuP,EAAY,IACvB,MACF,IAAK,SACC1P,EAAIG,GACNiB,EAAIjB,GAAOsP,EAAUzP,EAAIG,IAEzBiB,EAAIjB,GAAO,SAIZiB,EWtGiCqO,CAAU,CAAChL,QAAOA,EAAE4K,kBAAiBA,EAAER,SAAQA,MAGnF,OAFAnK,KAAKmE,QAAQnB,IAAI,uBAAwByF,EAAI,IAC7C5M,OAAO+K,KAAK3L,EAAK,SACVmM,EAAAA,GAAG,IAEZ,OAAOC,EAAAA,WAAW,uBAGbmD,EAAAhR,UAAA0R,WAAA,WACL,IAAMnL,EAAUC,KAAKmE,QAAQ1B,IAAI,wBACjC,GAAI1C,EAAS,CACX,IAAMnE,EAAYC,OACZsP,EAAexP,EAAgBC,GAE/BiC,EADgBpB,EAAON,EAAiB4D,IACZlC,YAClC,QAAsB,MAAfA,GAAuC,MAAhBsN,GACc,IAAtCtN,EAAYlB,QAAQwO,IAA6D,IAAtCA,EAAaxO,QAAQkB,IAC3C,MAArBjC,EAAEE,SAASwM,QAAqC,MAAnB1M,EAAEE,SAASyM,QAI3CiC,EAAAhR,UAAA4R,eAAA,WAAA,IAAA1J,EAAA1B,KACCD,EAAUC,KAAKmE,QAAQ1B,IAAI,wBACjC,GAAI1C,EAAS,CACX,IAAMnE,EAAYC,OACZsP,EAAexP,EAAgBC,GAC/BuF,EAAO1E,EAAON,EAAiB4D,IAC/BsL,EAAgBlK,EAAc,QAC9BwJ,EAAoBxJ,EAAwB,kBAC5CgJ,EAAWhJ,EAAe,SAC1BtD,EAAcwN,EAAcxN,YAClC,KAAmB,MAAfA,GAAuC,MAAhBsN,GACiB,IAAtCtN,EAAYlB,QAAQwO,IAA6D,IAAtCA,EAAaxO,QAAQkB,IAC3C,MAArBjC,EAAEE,SAASwM,QAAqC,MAAnB1M,EAAEE,SAASyM,MAAe,CAC3D,IAAMC,EAAc5M,EAAEE,SAASwM,OAAO1L,UAAU,GAAGxB,QAAQ,MAAO,IAE5DmN,EAAOpM,EADMP,EAAEE,SAASyM,KAAK3L,UAAU,GAAGxB,QAAQ,QAAS,KAE3DqN,EAAKtM,EAAiBqM,GACtBE,EAASvP,OAAAoI,OAAApI,OAAAoI,OAAA,GAAOkH,GAAOF,GAC7B,GAAIG,EAAUhO,MACZ,MAAM2M,EAAAA,WAAWqB,EAAUhO,OAE3B,OAAOsF,KAAKiK,MAAMqB,YAAYD,GAC3BE,iBAAiBF,EAAeV,EAAmBjC,EAAWyB,GAC9DvC,KAAKgC,EAAAA,KAAI,SAAA9I,GACRY,EAAKsE,OAAOtB,SAAS5D,GACrBY,EAAKyC,QAAQf,OAAO,4BAI5B,OAAOiE,EAAAA,WAAW,6BAEpB,OAAOA,EAAAA,WAAW,4DA9DrB1F,EAAAA,sDAROoI,SACA9F,SAGAsG,SAEArG,sBCKN,SAAAsH,EAAoBhC,EAA0BiC,EAA6B1K,EAA+B2K,GAAtF1L,KAAAwJ,KAAAA,EAA0BxJ,KAAAyL,MAAAA,EAA6BzL,KAAAe,OAAAA,EAA+Bf,KAAA0L,SAAAA,SAG1GF,EAAAhS,UAAAoN,KAAA,SAAK+E,EAA8BxB,GAAnC,IAAAzI,EAAA1B,KACQ4L,EAAY5L,KAAKe,OAAOhB,QAAQ/E,QAAUD,EAAQiF,KAAKe,OAAOhB,QAAQ/E,QAAS2Q,EAAa1Q,KAAO0Q,EAAa1Q,IACtH,OAAI0Q,EAAaE,WACR7L,KAAKwJ,KAAKG,KAAoBiC,EAAWD,GAC7C/D,KAAKkE,EAAAA,UAAS,SAAAnB,GACb,OAAAjJ,EAAKgK,SAAShB,GAAG,CAACiB,EAAa7N,sBAAuBzC,EAAiBsP,IAAoBxP,KAAK,KAC9FwQ,EAAchB,EAAmBR,OAElCnK,KAAKyL,MAAM7E,KAAK,cAAe+E,EAAc3L,KAAKe,OAAOhB,QAAQzC,SAASsK,KAC/EE,EAAAA,WAAU,SAAAZ,GACR,OAAAxF,EAAK8H,KAAKG,KAAoBiC,EAAWD,GAAc/D,KACrDgC,EAAAA,KAAI,SAAAe,GACF,OAAAzD,EACIA,EAAYpL,SAASV,QAAQ,CAACuQ,EAAa7N,sBAAuBzC,EAAiBsP,IAAoBxP,KAAK,WAC5GsD,KAENqJ,EAAAA,WAAU,SAAA6C,GACR,OAAAjJ,EAAK+J,MACFlE,aAAaL,EAAaxF,EAAKX,OAAOhB,QAAQzC,QAASqO,EAAa9N,aACpE+J,KAAKpM,EAAAA,KAAI,SAAAuQ,GAAa,MAAA,CAAEpB,kBAAiBA,EAAEoB,UAASA,cAI7DjE,EAAAA,WAAU,SAACrB,OAACkE,EAAiBlE,EAAAkE,kBAAEoB,EAAStF,EAAAsF,UAAM,OAAArK,EAAK6J,iBAAiBI,EAAchB,EAAmBoB,EAAW5B,QAIpHqB,EAAAhS,UAAA+R,iBAAA,SAAiBI,EACAhB,EACAoB,EACA5B,GACf,IAAM6B,EAAO,CAACL,aAAYA,EAAEhB,kBAAiBA,EAAEoB,UAASA,EAAE5B,SAAQA,GAC5D1D,EAA6BzG,KAAKe,OAAOhB,QAAxCE,EAAewG,EAAAxG,gBAAEjF,EAAOyL,EAAAzL,QACxBmL,EAAwBwF,EAAYM,OAApCA,OAAM,IAAA9F,EAAG,OAAMA,EAAElL,EAAO0Q,EAAY1Q,IACrCiR,EAAsBlR,EAAUD,EAAQC,EAASC,GAAOA,EAC9D,OAAO+E,KAAKwJ,KAAK2C,QAA6BF,EAAQC,EAAqB,CAACF,KAAIA,EAAE/L,gBAAeA,8BAxCpG0B,EAAAA,sDAXOmI,EAAAA,kBAOAnD,SAFA7G,SAIA0K,sBCIN,SAAA4B,EAAoB5C,EAA0BiC,EAA6B1K,EAA+B2K,GAAtF1L,KAAAwJ,KAAAA,EAA0BxJ,KAAAyL,MAAAA,EAA6BzL,KAAAe,OAAAA,EAA+Bf,KAAA0L,SAAAA,SAG1GU,EAAA5S,UAAAoN,KAAA,SAAK+E,EAA8BxB,GAAnC,IAAAzI,EAAA1B,KACQ2K,EAAoB3K,KAAKqM,qBAAqBV,GAC9C1Q,EAAM,CAAC0Q,EAAa7N,sBAAuBzC,EAAiBsP,IAAoBxP,KAAK,KAC3F,OAAIwQ,EAAaE,WACR7L,KAAK0L,SAAShB,GAAGzP,EAAK0Q,EAAchB,EAAmBR,GAEzDnK,KAAKyL,MAAM7E,KAAK3L,EAAK0Q,EAAc3L,KAAKe,OAAOhB,QAAQzC,SAASsK,KACrEE,EAAAA,WAAU,SAACjM,GACT,OAAA6F,EAAK+J,MAAMlE,aAAa1L,EAAQ6F,EAAKX,OAAOhB,QAAQzC,QAASqO,EAAa9N,gBAE5EiK,EAAAA,WAAU,SAACiE,GAKT,MAAkC,UAA9BJ,EAAaW,cAA6BX,EAAa1Q,IAIvD8Q,EAAUhN,OAASgN,EAAUhN,QAAU4L,EAAkB5L,MACpDsI,EAAAA,WAAW,0BAEb3F,EAAK6J,iBAAiBI,EAAchB,EAAmBoB,EAAW5B,GANhE/C,EAAAA,GAAG3K,EAAOsP,SAWzBK,EAAA5S,UAAA+R,iBAAA,SAAiBxL,EACA4K,EACAoB,EACA5B,GACf,IAAM6B,EAAO,CAACrB,kBAAiBA,EAAEoB,UAASA,EAAE5B,SAAQA,GAC9C1D,EAA6BzG,KAAKe,OAAOhB,QAAxC/E,EAAOyL,EAAAzL,QAAEiF,EAAewG,EAAAxG,gBACxBhF,EAAwB8E,EAAO9E,IAA1BkL,EAAmBpG,EAAOkM,OAA1BA,OAAM,IAAA9F,EAAG,OAAMA,EACrB+F,EAAsBlR,EAAUD,EAAQC,EAASC,GAAOA,EAC9D,OAAO+E,KAAKwJ,KAAK2C,QAA6BF,EAAQC,EAAqB,CAACF,KAAIA,EAAE/L,gBAAeA,KAG3FmM,EAAA5S,UAAA6S,qBAAA,SAAqBtM,GAEzB,IAAA0G,EAOE1G,EAAOuM,aAPTA,OAAY,IAAA7F,EAAG,OAAMA,EACrB8F,EAMExM,EAAOwM,SALTpG,EAKEpG,EAAOlC,YALTA,OAAW,IAAAsI,EAAGxK,KAAqB,GAAEwK,EACrCqG,EAIEzM,EAAO7B,eAJTA,OAAc,IAAAsO,EAAG,IAAGA,EACpBvO,EAGE8B,EAAO9B,MAFTc,EAEEgB,EAAOhB,MADThB,EACEgC,EAAOhC,oBACL0O,EAAiC,mBAAV1N,EAAuBA,IAAUA,EAC9D,OAAOpE,EAAA,CACL,CAAC,gBAAiB2R,GAClB,CAAC,YAAaC,GACd,CAAC,eAAgB1O,IACbkB,EAAQ,CAAC,CAAC,QAAS0N,IAAkB,GACrCxO,EAAQ,CAAC,CAAC,QAASA,EAAM9C,KAAK+C,KAAoB,GAClDH,EACA5E,OAAOoC,KAAKwC,GAAqBvC,KAAI,SAAAC,GACrC,IAAMhB,EAAqDsD,EAA4BtC,GACvF,MAAqB,iBAAVhB,EACF,CAACgB,EAAKhB,GACa,mBAAVA,EACT,CAACgB,EAAKhB,KACM,OAAVA,EACF,CAACgB,EAAK,IAER,CAAC,GAAI,OAEZ,IAEHoB,QAAO,SAAA6P,GAAK,QAAEA,EAAE,MAChBpQ,QAAO,SAACqQ,EAAKrS,SAAS,OAAAnB,OAAAoI,OAAApI,OAAAoI,OAAA,GAAKoL,KAAGlG,EAAA,IAAGnM,EAAK,IAAKA,EAAK,GAAEmM,MAAI,8BA3E5D9E,EAAAA,sDAXOmI,EAAAA,kBAOAnD,SAFA7G,SAIA0K,sBCcN,SAAAD,EAAoBf,EAA0BxD,EAC1BjF,EAA+B0K,GAD/BzL,KAAAwJ,KAAAA,EAA0BxJ,KAAAgG,OAAAA,EAC1BhG,KAAAe,OAAAA,EAA+Bf,KAAAyL,MAAAA,EAR1CzL,KAAA4M,aAAe,CACtB,CAACC,QAAS/C,EAAAA,WAAYgD,SAAU9M,KAAKwJ,MACrC,CAACqD,QAASlG,EAAcmG,SAAU9M,KAAKyL,OACvC,CAACoB,QAAS/M,EAAegN,SAAU9M,KAAKe,SAEjCf,KAAA+M,KAAO,CAACjD,EAAAA,WAAYnD,EAAc7G,UAMpCyK,EAAA/Q,UAAA0Q,aAAA,SAAatM,EAAcuM,GAA3B,IAAAzI,EAAA1B,KAGL,OAFiBA,KAAKsL,YAAY1N,GAElBgJ,KAAK5G,KAAKe,OAAOhB,QAAQuB,UAAU1D,GAAOuM,GAAY,IAAIvC,KACxEgC,EAAAA,KAAI,SAAA9I,GAIEY,EAAKX,OAAOhB,QAAQuB,UAAU1D,GAAM3C,KACtCyG,EAAKsE,OAAOtB,SAAS5D,QAMtByJ,EAAA/Q,UAAA8R,YAAA,SAAY0B,GAMjB,MAHW,SAFkB,iBAAhB,EAA2BhN,KAAKe,OAAOhB,QAAQuB,UAAU0L,GAAc7O,UAAa6O,EAAgC,WAG3HC,EAAAA,SAAStT,OAAMgB,EAAKqF,KAAK4M,aAAY,CAAE,CAACC,QAASrB,EAAeuB,KAAM/M,KAAK+M,SAAQtK,IAAI+I,GACvFyB,EAAAA,SAAStT,OAAMgB,EAAKqF,KAAK4M,aAAY,CAAE,CAACC,QAAST,EAAeW,KAAM/M,KAAK+M,SAAQtK,IAAI2J,IAIxF7B,EAAA/Q,UAAA6Q,OAAA,SAAUC,EAAkBrP,EAA2EgR,GAC5G,YADiC,IAAAhR,IAAAA,EAAMF,EAAQiF,KAAKe,OAAOhB,QAAQ/E,QAASgF,KAAKe,OAAOhB,QAAQM,iBAAY,IAAA4L,IAAAA,EAAA,QACrGjM,KAAKwJ,KAAK2C,QAAWF,EAAQhR,EAAK,CAAC+Q,KAAM,CAAC1B,SAAQA,+BAtC5D3I,EAAAA,sDALOmI,EAAAA,kBADA5F,SADApE,SADA6G,sBCKN,SAAAuG,EAAoBxB,GAAA1L,KAAA0L,SAAAA,EAHV1L,KAAAmN,QAAU,IAAIC,EAAAA,aACdpN,KAAAqN,aAAe,IAAID,EAAAA,oBAK7BF,EAAA1T,UAAA8T,SAAA,WAAA,IAAA5L,EAAA1B,KACMA,KAAK0L,SAASR,cAChBlL,KAAK0L,SAASN,iBACXmC,UAAU,CACTjT,KAAM,SAAAG,GAAS,OAAAiH,EAAKyL,QAAQK,KAAK/S,IACjCC,MAAO,SAAA+S,GAAO,OAAA/L,EAAK2L,aAAaG,KAAKC,gCAf9CC,EAAAA,UAAS7L,KAAA,CAAC,CACT8L,SAAU,8DAJJnD,sCAOLoD,EAAAA,6BACAA,EAAAA,2BCYH,SAAAC,YACSA,EAAAC,QAAP,SAAeC,EAA2CC,GACxD,YADa,IAAAD,IAAAA,EAAA,SAA2C,IAAAC,IAAAA,GAAA,GACjD,CACLC,SAAUJ,EACVvM,UAAS3G,EAAA,CACP,CAACkS,QAASjN,EAAgBkN,SAAUiB,GACpC,CAAClB,QAAS/M,EAAeoO,SAAUpO,EAAeiN,KAAM,CAACnN,IACzD,CAACiN,QAAS5I,EAAgBiK,SAAUpM,EAAuBiL,KAAM,CAACjN,IAClE,CAAC+M,QAAS3I,EAAegK,SAAUhK,EAAe6I,KAAM,CAAC9I,EAAgBnE,IACzE,CAAC+M,QAAStD,EAAc2E,SAAU3E,EAAcwD,KAAM,CAACjD,EAAAA,WAAY5F,EAAepE,IAClF,CAAC+M,QAASlG,EAAcuH,SAAUvH,EAAcoG,KAAM,CAACjN,IACvD,CAAC+M,QAAStC,EAAc2D,SAAU3D,EAAcwC,KAAM,CAACjD,EAAAA,WAAY5F,EAAepE,EAAe6G,IACjG,CAACkG,QAAS9C,EAAamE,SAAUnE,EAAagD,KAAM,CAAC7I,EAAeqF,EAAcgB,IAClF,CAACsC,QAASrC,EAAiB0D,SAAU1D,EAAiBuC,KAAM,CAAChD,EAAa9F,EAAgBsG,EAAcrG,KACpG8J,EACA,CAAC,CAACnB,QAASsB,EAAAA,kBAAmBD,SAAUnI,EAAgBqI,OAAO,EAAMrB,KAAM,CAAC7I,EAAepE,KAC3F,+BArBXuO,EAAAA,SAAQxM,KAAA,CAAC,CACRyM,QAAS,CAACC,EAAAA,kBACVC,aAAc,CAACtB,GACfuB,QAAS","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, privateMap) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to get private field on non-instance\");\r\n    }\r\n    return privateMap.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, privateMap, value) {\r\n    if (!privateMap.has(receiver)) {\r\n        throw new TypeError(\"attempted to set private field on non-instance\");\r\n    }\r\n    privateMap.set(receiver, value);\r\n    return value;\r\n}\r\n","/**\r\n * Created by Ron on 17/12/2015.\r\n */\r\nimport {IHierarchicalObject, ISimpleObject} from './config-interfaces';\r\n\r\ndeclare const cordova: any;\r\n\r\nexport function joinUrl(baseUrl: string, url: string): string {\r\n  if (/^(?:[a-z]+:)?\\/\\//i.test(url)) {\r\n    return url;\r\n  }\r\n\r\n  const joined = [baseUrl, url].join('/');\r\n\r\n  return joined\r\n    .replace(/[\\/]+/g, '/')\r\n    .replace(/\\/\\?/g, '?')\r\n    .replace(/\\/\\#/g, '#')\r\n    .replace(/\\:\\//g, '://');\r\n}\r\n\r\nexport function buildQueryString(obj: ISimpleObject): string {\r\n  return Object.keys(obj)\r\n    .map(key => (!!obj[key] ? `${encodeURIComponent(key)}=${encodeURIComponent(obj[key])}` : key))\r\n    .join('&');\r\n}\r\n\r\nexport function getWindowOrigin(w?: Window): string | null {\r\n  if (!w && typeof window !== 'undefined') {\r\n    w = window;\r\n  }\r\n  try {\r\n    if (!w || !w.location) {\r\n      return null;\r\n    }\r\n    if (!w.location.origin) {\r\n      return `${w.location.protocol}//${w.location.hostname}${w.location.port ? ':' + w.location.port : ''}`;\r\n    }\r\n    return w.location.origin;\r\n  } catch (error) {\r\n    return null;\r\n    // ignore DOMException: Blocked a frame with origin from accessing a cross-origin frame.\r\n    // error instanceof DOMException && error.name === 'SecurityError'\r\n  }\r\n}\r\n\r\n\r\nexport function stringifyOptions(options: ISimpleObject): string {\r\n  return Object.keys(options)\r\n    .map(key => (options[key] === null || options[key] === undefined ? key : key + '=' + options[key]))\r\n    .join(',');\r\n}\r\n\r\nexport function parseQueryString(joinedKeyValue: string): { [k: string]: string | true } {\r\n  let key;\r\n  let value;\r\n  return joinedKeyValue.split('&').reduce(\r\n    (obj, keyValue) => {\r\n      if (keyValue) {\r\n        value = keyValue.split('=');\r\n        key = decodeURIComponent(value[0]);\r\n        obj[key] = typeof value[1] !== 'undefined' ? decodeURIComponent(value[1]) : true;\r\n      }\r\n      return obj;\r\n    },\r\n    {} as { [k: string]: string | true }\r\n  );\r\n}\r\n\r\nexport function flatten(obj: IHierarchicalObject): ISimpleObject {\r\n  const out = {} as ISimpleObject;\r\n  Object.keys(obj).forEach(key => {\r\n    if (typeof (obj[key]) === 'object') {\r\n      const subobj = flatten(obj[key] as IHierarchicalObject);\r\n      Object.keys(subobj).forEach(subkey => out[key + '.' + subkey] = subobj[subkey]);\r\n    } else {\r\n      out[key] = obj[key] as string | number | boolean | null;\r\n    }\r\n  });\r\n  return out;\r\n}\r\n\r\nexport function expand(obj: ISimpleObject): IHierarchicalObject {\r\n  const out = {} as IHierarchicalObject;\r\n  const roots = Object.keys(obj)\r\n    .map(key => key.indexOf('.') > -1 ? key.substring(0, key.indexOf('.')) : key)\r\n    .filter((value, index, array) => array.indexOf(value) === index);\r\n  roots.forEach(key => {\r\n    if (obj[key]) {\r\n      out[key] = obj[key];\r\n    } else {\r\n      const childObject = {} as ISimpleObject;\r\n      Object.keys(obj).filter(k => k.startsWith(key + '.')).forEach(k => {\r\n        childObject[k.substr(key.length + 1)] = obj[k];\r\n      });\r\n      out[key] = expand(childObject);\r\n    }\r\n  });\r\n  return out;\r\n}\r\n\r\nexport function staticify(obj: object): IHierarchicalObject {\r\n  const out = {} as IHierarchicalObject;\r\n  Object.keys(obj).forEach(key => {\r\n    switch (typeof (obj[key])) {\r\n      case 'number':\r\n      case 'string':\r\n      case 'boolean':\r\n        out[key] = obj[key] as string | number | boolean;\r\n        break;\r\n      case 'function':\r\n        const tmpObj = staticify({tmp: (obj[key] as Function)()});\r\n        out[key] = tmpObj['tmp'];\r\n        break;\r\n      case 'object':\r\n        if (obj[key]) {\r\n          out[key] = staticify(obj[key]);\r\n        } else {\r\n          out[key] = null;\r\n        }\r\n    }\r\n  });\r\n  return out;\r\n}\r\n\r\nexport function isCordovaApp(): boolean {\r\n  return typeof cordova === 'object' || (document.URL.indexOf('http://') === -1 && document.URL.indexOf('https://') === -1);\r\n}\r\n","export enum StorageType {\r\n  NONE = 'none',\r\n  MEMORY = 'memory',\r\n  LOCAL_STORAGE = 'localStorage',\r\n  SESSION_STORAGE = 'sessionStorage',\r\n  COOKIE = 'cookie',\r\n  SESSION_COOKIE = 'sessionCookie'\r\n}\r\n","import { IProviders } from '../public_api';\r\nimport { getWindowOrigin } from './utils';\r\n\r\nexport const defaultProviders: IProviders = {\r\n  facebook: {\r\n    name: 'facebook',\r\n    url: '/auth/facebook',\r\n    redirectUri: `${getWindowOrigin()}/`,\r\n    authorizationEndpoint: 'https://www.facebook.com/v2.5/dialog/oauth',\r\n    additionalUrlParams: {\r\n      display: 'popup'\r\n    },\r\n    scope: ['email'],\r\n    scopeDelimiter: ',',\r\n    oauthType: '2.0',\r\n    popupOptions: { width: 580, height: 400 }\r\n  },\r\n  google: {\r\n    name: 'google',\r\n    url: '/auth/google',\r\n    authorizationEndpoint: 'https://accounts.google.com/o/oauth2/v2/auth',\r\n    additionalUrlParams: {\r\n      display: 'popup',\r\n      prompt: undefined,\r\n      login_hint: undefined,\r\n      access_type: undefined,\r\n      include_granted_scopes: undefined,\r\n      'openid.realm': undefined,\r\n      hd: undefined\r\n    },\r\n    scope: ['openid', 'email'],\r\n    scopeDelimiter: ' ',\r\n    oauthType: '2.0',\r\n    popupOptions: { width: 452, height: 633 },\r\n    state: () =>\r\n      encodeURIComponent(\r\n        Math.random()\r\n          .toString(36)\r\n          .substr(2)\r\n      )\r\n  },\r\n  github: {\r\n    name: 'github',\r\n    url: '/auth/github',\r\n    authorizationEndpoint: 'https://github.com/login/oauth/authorize',\r\n    scope: ['user:email'],\r\n    scopeDelimiter: ' ',\r\n    oauthType: '2.0',\r\n    popupOptions: { width: 1020, height: 618 }\r\n  },\r\n  instagram: {\r\n    name: 'instagram',\r\n    url: '/auth/instagram',\r\n    authorizationEndpoint: 'https://api.instagram.com/oauth/authorize',\r\n    scope: ['basic'],\r\n    scopeDelimiter: '+',\r\n    oauthType: '2.0'\r\n  },\r\n  linkedin: {\r\n    name: 'linkedin',\r\n    url: '/auth/linkedin',\r\n    authorizationEndpoint: 'https://www.linkedin.com/uas/oauth2/authorization',\r\n    scope: ['r_emailaddress'],\r\n    scopeDelimiter: ' ',\r\n    oauthType: '2.0',\r\n    popupOptions: { width: 527, height: 582 },\r\n    state: 'STATE'\r\n  },\r\n  twitter: {\r\n    name: 'twitter',\r\n    url: '/auth/twitter',\r\n    authorizationEndpoint: 'https://api.twitter.com/oauth/authenticate',\r\n    oauthType: '1.0',\r\n    popupOptions: { width: 495, height: 645 }\r\n  },\r\n  twitch: {\r\n    name: 'twitch',\r\n    url: '/auth/twitch',\r\n    authorizationEndpoint: 'https://api.twitch.tv/kraken/oauth2/authorize',\r\n    scope: ['user_read'],\r\n    scopeDelimiter: ' ',\r\n    additionalUrlParams: {\r\n      display: 'popup'\r\n    },\r\n    oauthType: '2.0',\r\n    popupOptions: { width: 500, height: 560 }\r\n  },\r\n  live: {\r\n    name: 'live',\r\n    url: '/auth/live',\r\n    authorizationEndpoint: 'https://login.live.com/oauth20_authorize.srf',\r\n    additionalUrlParams: {\r\n      display: 'popup'\r\n    },\r\n    scope: ['wl.emails'],\r\n    scopeDelimiter: ' ',\r\n    oauthType: '2.0',\r\n    popupOptions: { width: 500, height: 560 }\r\n  },\r\n  yahoo: {\r\n    name: 'yahoo',\r\n    url: '/auth/yahoo',\r\n    authorizationEndpoint: 'https://api.login.yahoo.com/oauth2/request_auth',\r\n    scope: [],\r\n    scopeDelimiter: ',',\r\n    oauthType: '2.0',\r\n    popupOptions: { width: 559, height: 519 }\r\n  },\r\n  bitbucket: {\r\n    name: 'bitbucket',\r\n    url: '/auth/bitbucket',\r\n    authorizationEndpoint: 'https://bitbucket.org/site/oauth2/authorize',\r\n    redirectUri: `${getWindowOrigin()}/`,\r\n    scope: ['email'],\r\n    scopeDelimiter: ',',\r\n    oauthType: '2.0',\r\n    popupOptions: { width: 1028, height: 529 }\r\n  },\r\n  spotify: {\r\n    name: 'spotify',\r\n    url: '/auth/spotify',\r\n    authorizationEndpoint: 'https://accounts.spotify.com/authorize',\r\n    scope: ['', 'user-read-email'],\r\n    scopeDelimiter: ',',\r\n    oauthType: '2.0',\r\n    popupOptions: { width: 500, height: 530 },\r\n    state: () =>\r\n      encodeURIComponent(\r\n        Math.random()\r\n          .toString(36)\r\n          .substr(2)\r\n      )\r\n  }\r\n};\r\n","import { Inject, Injectable, InjectionToken } from '@angular/core';\r\nimport { IConfigOptions, IPartialConfigOptions, IProviders } from './config-interfaces';\r\nimport { defaultProviders } from './config-providers';\r\nimport { StorageType } from './storage-type.enum';\r\n\r\nexport const CONFIG_OPTIONS = new InjectionToken<any>('config.options');\r\n@Injectable()\r\nexport class ConfigService {\r\n  public options = {\r\n    withCredentials: false,\r\n    tokenRoot: null,\r\n    baseUrl: '/',\r\n    loginUrl: '/auth/login',\r\n    signupUrl: '/auth/signup',\r\n    unlinkUrl: '/auth/unlink/',\r\n    tokenName: 'token',\r\n    tokenSeparator: '_',\r\n    tokenPrefix: 'ng2-ui-auth',\r\n    authHeader: 'Authorization',\r\n    authToken: 'Bearer',\r\n    storageType: StorageType.LOCAL_STORAGE,\r\n    cordova: undefined,\r\n    resolveToken: (response: any, config: IConfigOptions) => {\r\n      const accessToken: string | { [key: string]: string } | null | undefined =\r\n        response && (response.access_token || response.token || response.data);\r\n      if (!accessToken) {\r\n        // console.warn('No token found');\r\n        return null;\r\n      }\r\n      if (typeof accessToken === 'string') {\r\n        return accessToken;\r\n      }\r\n      if (typeof accessToken !== 'object') {\r\n        // console.warn('No token found');\r\n        return null;\r\n      }\r\n      const tokenRootData =\r\n        config.tokenRoot &&\r\n        config.tokenRoot.split('.').reduce((o: any, x: any) => {\r\n          return o[x];\r\n        }, accessToken);\r\n      const token = tokenRootData ? tokenRootData[config.tokenName] : accessToken[config.tokenName];\r\n      if (token) {\r\n        return token;\r\n      }\r\n      // const tokenPath = this.tokenRoot ? this.tokenRoot + '.' + this.tokenName : this.tokenName;\r\n      // console.warn('Expecting a token named \"' + tokenPath);\r\n      return null;\r\n    },\r\n    providers: {}\r\n  };\r\n\r\n  constructor(@Inject(CONFIG_OPTIONS) options: IPartialConfigOptions) {\r\n    this.options = {\r\n      ...this.options,\r\n      ...options\r\n    };\r\n    this.mergeWithDefaultProviders();\r\n  }\r\n\r\n  updateProviders(providers: IProviders) {\r\n    this.options.providers = {\r\n      ...(this.options.providers || {}),\r\n      ...providers\r\n    };\r\n    this.mergeWithDefaultProviders();\r\n  }\r\n\r\n  mergeWithDefaultProviders() {\r\n    Object.keys(this.options.providers).forEach(key => {\r\n      if (key in defaultProviders) {\r\n        this.options.providers[key] = {\r\n          ...defaultProviders[key],\r\n          ...this.options.providers[key]\r\n        };\r\n      }\r\n    });\r\n  }\r\n}\r\n","import { StorageType } from './storage-type.enum';\r\n\r\nexport abstract class StorageService {\r\n  abstract updateStorageType(storageType: StorageType): boolean;\r\n\r\n  abstract get(key: string): string;\r\n\r\n  abstract set(key: string, value: string, date: string): void;\r\n\r\n  abstract remove(key: string): void;\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { StorageService } from './storage-service';\r\nimport { StorageType } from './storage-type.enum';\r\nimport { ConfigService } from './config.service';\r\n\r\n@Injectable()\r\nexport class BrowserStorageService extends StorageService {\r\n  private store: { [key: string]: string } = {};\r\n  private storageType = StorageType.MEMORY;\r\n\r\n  constructor(private config: ConfigService) {\r\n    super();\r\n    if (!this.updateStorageType(config.options.storageType)) {\r\n      console.warn(config.options.storageType + ' is not available.');\r\n    }\r\n  }\r\n\r\n  public updateStorageType(storageType: StorageType) {\r\n    const isStorageAvailable = this.checkIsStorageAvailable(storageType);\r\n    if (!isStorageAvailable) {\r\n      return false;\r\n    }\r\n    this.storageType = storageType;\r\n    return true;\r\n  }\r\n\r\n  public get(key: string) {\r\n    switch (this.storageType) {\r\n      case StorageType.COOKIE:\r\n      case StorageType.SESSION_COOKIE:\r\n        return this.getCookie(key);\r\n      case StorageType.LOCAL_STORAGE:\r\n      case StorageType.SESSION_STORAGE:\r\n        return window[this.storageType].getItem(key);\r\n      case StorageType.MEMORY:\r\n        return this.store[key];\r\n      case StorageType.NONE:\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n\r\n  public set(key: string, value: string, date: string) {\r\n    switch (this.storageType) {\r\n      case StorageType.COOKIE:\r\n      case StorageType.SESSION_COOKIE:\r\n        this.setCookie(key, value, this.storageType === StorageType.COOKIE ? date : '');\r\n        break;\r\n      case StorageType.LOCAL_STORAGE:\r\n      case StorageType.SESSION_STORAGE:\r\n        window[this.storageType].setItem(key, value);\r\n        break;\r\n      case StorageType.MEMORY:\r\n        this.store[key] = value;\r\n        break;\r\n      case StorageType.NONE:\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  public remove(key: string) {\r\n    switch (this.storageType) {\r\n      case StorageType.COOKIE:\r\n      case StorageType.SESSION_COOKIE:\r\n        this.removeCookie(key);\r\n        break;\r\n      case StorageType.LOCAL_STORAGE:\r\n      case StorageType.SESSION_STORAGE:\r\n        window[this.storageType].removeItem(key);\r\n        break;\r\n      case StorageType.MEMORY:\r\n        delete this.store[key];\r\n        break;\r\n      case StorageType.NONE:\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  private checkIsStorageAvailable(storageType: StorageType) {\r\n    switch (storageType) {\r\n      case StorageType.COOKIE:\r\n      case StorageType.SESSION_COOKIE:\r\n        return this.isCookieStorageAvailable();\r\n      case StorageType.LOCAL_STORAGE:\r\n      case StorageType.SESSION_STORAGE:\r\n        return this.isWindowStorageAvailable(storageType);\r\n      case StorageType.NONE:\r\n      case StorageType.MEMORY:\r\n        return true;\r\n      default:\r\n        return false;\r\n    }\r\n  }\r\n\r\n  private isWindowStorageAvailable(storageType: StorageType.SESSION_STORAGE | StorageType.LOCAL_STORAGE) {\r\n    try {\r\n      const supported = window && storageType in window && window[storageType] !== null;\r\n\r\n      if (supported) {\r\n        const key = Math.random()\r\n          .toString(36)\r\n          .substring(7);\r\n        window[storageType].setItem(key, '');\r\n        window[storageType].removeItem(key);\r\n      }\r\n\r\n      return supported;\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private isCookieStorageAvailable() {\r\n    try {\r\n      const supported = document && 'cookie' in document;\r\n\r\n      if (supported) {\r\n        const key = Math.random()\r\n          .toString(36)\r\n          .substring(7);\r\n        this.setCookie(key, 'test', new Date(Date.now() + 60 * 1000).toUTCString());\r\n        const value = this.getCookie(key);\r\n        this.removeCookie(key);\r\n        return value === 'test';\r\n      }\r\n      return false;\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private setCookie(key: string, value: string, expires = '', path = '/') {\r\n    document.cookie = `${key}=${value}${expires ? `; expires=${expires}` : ''}; path=${path}`;\r\n  }\r\n\r\n  private removeCookie(key: string, path = '/') {\r\n    this.setCookie(key, '', new Date(0).toUTCString(), path);\r\n  }\r\n\r\n  private getCookie(key: string) {\r\n    return document.cookie.replace(new RegExp(`(?:(?:^|.*;\\\\s*)${key}\\\\s*\\\\=\\\\s*([^;]*).*$)|^.*$`), '$1');\r\n  }\r\n}\r\n","import {Injectable} from '@angular/core';\r\nimport {StorageType} from './storage-type.enum';\r\nimport {Subscriber, Observable} from 'rxjs';\r\nimport {StorageService} from './storage-service';\r\nimport {ConfigService} from './config.service';\r\n\r\n@Injectable()\r\nexport class SharedService {\r\n  public tokenName = this.config.options.tokenPrefix\r\n    ? [this.config.options.tokenPrefix, this.config.options.tokenName].join(this.config.options.tokenSeparator)\r\n    : this.config.options.tokenName;\r\n\r\n  constructor(private storage: StorageService, private config: ConfigService) {\r\n  }\r\n\r\n  public getToken(): string | null {\r\n    return this.storage.get(this.tokenName);\r\n  }\r\n\r\n  public getPayload(token = this.getToken()): any {\r\n    if (token && token.split('.').length === 3) {\r\n      try {\r\n        const base64Url = token.split('.')[1];\r\n        const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n        return JSON.parse(this.b64DecodeUnicode(base64));\r\n      } catch (e) {\r\n        return undefined;\r\n      }\r\n    }\r\n  }\r\n\r\n  public setToken(response: string | object): void {\r\n    if (!response) {\r\n      // console.warn('Can\\'t set token without passing a value');\r\n      return;\r\n    }\r\n\r\n    let token: string;\r\n    if (typeof response === 'string') {\r\n      token = response;\r\n    } else {\r\n      token = this.config.options.resolveToken(response, this.config.options);\r\n    }\r\n\r\n    if (token) {\r\n      const expDate = this.getExpirationDate(token);\r\n      this.storage.set(this.tokenName, token, expDate ? expDate.toUTCString() : '');\r\n    }\r\n  }\r\n\r\n  public removeToken(): void {\r\n    this.storage.remove(this.tokenName);\r\n  }\r\n\r\n  public isAuthenticated(token = this.getToken()): boolean {\r\n    // a token is present\r\n    if (token) {\r\n      // token with a valid JWT format XXX.YYY.ZZZ\r\n      if (token.split('.').length === 3) {\r\n        // could be a valid JWT or an access token with the same format\r\n        try {\r\n          const base64Url = token.split('.')[1];\r\n          const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');\r\n          const exp = JSON.parse(this.b64DecodeUnicode(base64)).exp;\r\n          // jwt with an optional expiration claims\r\n          if (exp) {\r\n            const isExpired = Math.round(new Date().getTime() / 1000) >= exp;\r\n            if (isExpired) {\r\n              // fail: Expired token\r\n              this.storage.remove(this.tokenName);\r\n              return false;\r\n            } else {\r\n              // pass: Non-expired token\r\n              return true;\r\n            }\r\n          }\r\n        } catch (e) {\r\n          // pass: Non-JWT token that looks like JWT\r\n          return true;\r\n        }\r\n      }\r\n      // pass: All other tokens\r\n      return true;\r\n    }\r\n    // lail: No token at all\r\n    return false;\r\n  }\r\n\r\n  public getExpirationDate(token = this.getToken()): Date | null {\r\n    const payload = this.getPayload(token);\r\n    if (payload && payload.exp && Math.round(new Date().getTime() / 1000) < payload.exp) {\r\n      const date = new Date(0);\r\n      date.setUTCSeconds(payload.exp);\r\n      return date;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  public logout(): Observable<any> {\r\n    return new Observable<any>((observer: Subscriber<any>) => {\r\n      this.storage.remove(this.tokenName);\r\n      observer.next();\r\n      observer.complete();\r\n    });\r\n  }\r\n\r\n  public setStorageType(type: StorageType): boolean {\r\n    return this.storage.updateStorageType(type);\r\n  }\r\n\r\n  private b64DecodeUnicode(str): string {\r\n    return decodeURIComponent(Array.prototype.map\r\n      .call(atob(str), c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2))\r\n      .join(''));\r\n  }\r\n}\r\n","import { Injectable } from '@angular/core';\r\nimport { HttpInterceptor, HttpRequest, HttpHandler, HttpEvent } from '@angular/common/http';\r\nimport { SharedService } from './shared.service';\r\nimport { ConfigService } from './config.service';\r\nimport { Observable } from 'rxjs';\r\n\r\n@Injectable()\r\nexport class JwtInterceptor implements HttpInterceptor {\r\n  constructor(private shared: SharedService, private config: ConfigService) {}\r\n\r\n  intercept(req: HttpRequest<any>, next: HttpHandler): Observable<HttpEvent<any>> {\r\n    const { authHeader, authToken } = this.config.options;\r\n    const token = this.shared.getToken();\r\n    const isAuthenticated = this.shared.isAuthenticated();\r\n    const newReq =\r\n      isAuthenticated && !req.headers.has(authHeader) ? req.clone({ setHeaders: { [authHeader]: `${authToken} ${token}` } }) : req;\r\n    return next.handle(newReq);\r\n  }\r\n}\r\n","import {Injectable} from '@angular/core';\r\nimport {EMPTY, fromEvent, interval, merge, Observable, of, throwError} from 'rxjs';\r\nimport {delay, map, switchMap, take} from 'rxjs/operators';\r\nimport {IOauth1Options, IOauth2Options, IPopupOptions, ISimpleObject} from './config-interfaces';\r\nimport {getWindowOrigin, isCordovaApp, parseQueryString, stringifyOptions} from './utils';\r\n\r\n\r\n@Injectable()\r\nexport class PopupService {\r\n  public open(url: string, options: IOauth2Options | IOauth1Options, isCordova = isCordovaApp()): Observable<Window> {\r\n    const stringifiedOptions = stringifyOptions(this.prepareOptions(options.popupOptions));\r\n    const windowName = isCordova ? '_blank' : options.name;\r\n\r\n    const popupWindow = typeof window !== 'undefined' ? window.open(url, windowName, stringifiedOptions) : null;\r\n\r\n    if (popupWindow) {\r\n      if (popupWindow.focus) {\r\n        popupWindow.focus();\r\n      }\r\n      return of(popupWindow);\r\n    }\r\n    return throwError(new Error('Popup was not created'));\r\n  }\r\n\r\n  public waitForClose(popupWindow: Window, isCordova = isCordovaApp(), redirectUri = getWindowOrigin()): Observable<ISimpleObject> {\r\n    return isCordova ? this.eventListener(popupWindow, redirectUri) : this.pollPopup(popupWindow, redirectUri);\r\n  }\r\n\r\n  private eventListener(popupWindow: Window, redirectUri = getWindowOrigin()): Observable<ISimpleObject> {\r\n    if (!popupWindow) {\r\n      return throwError(new Error('Popup was not created'));\r\n    }\r\n    return merge(\r\n      fromEvent<Event>(popupWindow, 'exit').pipe(\r\n        delay(100),\r\n        map(() => {\r\n          throw new Error('Authentication Canceled');\r\n        })\r\n      ),\r\n      fromEvent(popupWindow, 'loadstart')\r\n    ).pipe(\r\n      switchMap((event: Event & { url: string }) => {\r\n        if (!popupWindow || popupWindow.closed) {\r\n          return Observable.throw(new Error('Authentication Canceled'));\r\n        }\r\n        if (event.url.indexOf(redirectUri) !== 0) {\r\n          return EMPTY;\r\n        }\r\n\r\n        const parser = document.createElement('a');\r\n        parser.href = event.url;\r\n\r\n        if (parser.search || parser.hash) {\r\n          const queryParams = parser.search.substring(1).replace(/\\/$/, '');\r\n          const hashParams = parser.hash.substring(1).replace(/\\/$/, '');\r\n          const hash = parseQueryString(hashParams);\r\n          const qs = parseQueryString(queryParams);\r\n          const allParams = {...qs, ...hash};\r\n\r\n          popupWindow.close();\r\n\r\n          if (allParams.error) {\r\n            throw allParams.error;\r\n          } else {\r\n            return of(allParams);\r\n          }\r\n        }\r\n        return EMPTY;\r\n      }),\r\n      take(1)\r\n    );\r\n  }\r\n\r\n  private pollPopup(popupWindow: Window, redirectUri = getWindowOrigin()): Observable<ISimpleObject> {\r\n    return interval(50).pipe(\r\n      switchMap(() => {\r\n        if (!popupWindow || popupWindow.closed) {\r\n          return throwError(new Error('Authentication Canceled'));\r\n        }\r\n\r\n        const popupWindowOrigin = getWindowOrigin(popupWindow);\r\n\r\n        if (\r\n          popupWindowOrigin &&\r\n          (redirectUri.indexOf(popupWindowOrigin) === 0 || popupWindowOrigin.indexOf(redirectUri) === 0) &&\r\n          (popupWindow.location.search || popupWindow.location.hash)\r\n        ) {\r\n          const queryParams = popupWindow.location.search.substring(1).replace(/\\/$/, '');\r\n          const hashParams = popupWindow.location.hash.substring(1).replace(/[\\/$]/, '');\r\n          const hash = parseQueryString(hashParams);\r\n          const qs = parseQueryString(queryParams);\r\n          popupWindow.close();\r\n          const allParams = {...qs, ...hash};\r\n          if (allParams.error) {\r\n            return throwError(allParams.error);\r\n          } else {\r\n            return of(allParams);\r\n          }\r\n        }\r\n        return EMPTY;\r\n      }),\r\n      take(1)\r\n    );\r\n  }\r\n\r\n  private prepareOptions(options?: IPopupOptions): ISimpleObject {\r\n    options = options || {};\r\n    const width = options.width || 500;\r\n    const height = options.height || 500;\r\n    return {\r\n      width,\r\n      height,\r\n      left: window.screenX + (window.outerWidth - width) / 2,\r\n      top: window.screenY + (window.outerHeight - height) / 2.5,\r\n      toolbar: options.visibleToolbar ? 'yes' : 'no',\r\n      ...options\r\n    };\r\n  }\r\n}\r\n","import {Injectable} from '@angular/core';\r\nimport {HttpClient} from '@angular/common/http';\r\nimport {SharedService} from './shared.service';\r\nimport {ConfigService} from './config.service';\r\nimport {joinUrl} from './utils';\r\nimport {tap} from 'rxjs/operators';\r\nimport {Observable} from 'rxjs';\r\nimport {IHierarchicalObject} from './config-interfaces';\r\n\r\n@Injectable()\r\nexport class LocalService {\r\n  constructor(private http: HttpClient, private shared: SharedService, private config: ConfigService) {\r\n  }\r\n\r\n  public login(user: string | IHierarchicalObject, url?: string): Observable<IHierarchicalObject> {\r\n    return this.http\r\n      .post<IHierarchicalObject>(url || joinUrl(this.config.options.baseUrl, this.config.options.loginUrl), user)\r\n      .pipe(tap(data => this.shared.setToken(data)));\r\n  }\r\n\r\n  public signup(user: string | IHierarchicalObject, url?: string): Observable<IHierarchicalObject> {\r\n    return this.http.post<IHierarchicalObject>(url || joinUrl(this.config.options.baseUrl, this.config.options.signupUrl), user);\r\n  }\r\n}\r\n","import {Injectable} from '@angular/core';\r\nimport {Observable} from 'rxjs';\r\nimport {LocalService} from './local.service';\r\nimport {OauthService} from './oauth.service';\r\nimport {SharedService} from './shared.service';\r\nimport {StorageType} from './storage-type.enum';\r\nimport {IHierarchicalObject} from './config-interfaces';\r\n\r\n@Injectable()\r\nexport class AuthService {\r\n  constructor(private shared: SharedService, private local: LocalService, private oauth: OauthService) {\r\n  }\r\n\r\n  public login(user: string | IHierarchicalObject, url?: string): Observable<IHierarchicalObject> {\r\n    return this.local.login(user, url);\r\n  }\r\n\r\n  public signup(user: string | IHierarchicalObject, url?: string): Observable<IHierarchicalObject> {\r\n    return this.local.signup(user, url);\r\n  }\r\n\r\n  public logout(): Observable<void> {\r\n    return this.shared.logout();\r\n  }\r\n\r\n  public authenticate(name: string, userData?: IHierarchicalObject): Observable<IHierarchicalObject> {\r\n    return this.oauth.authenticate(name, userData);\r\n  }\r\n\r\n  public link(name: string, userData?: IHierarchicalObject): Observable<IHierarchicalObject> {\r\n    return this.oauth.authenticate(name, userData);\r\n  }\r\n\r\n  public unlink<T = any>(provider: string, url?: string): Observable<T> {\r\n    return this.oauth.unlink<T>(provider, url);\r\n  }\r\n\r\n  public isAuthenticated(): boolean {\r\n    return this.shared.isAuthenticated();\r\n  }\r\n\r\n  public getToken(): string | null {\r\n    return this.shared.getToken();\r\n  }\r\n\r\n  public setToken(token: string | object): void {\r\n    this.shared.setToken(token);\r\n  }\r\n\r\n  public removeToken(): void {\r\n    this.shared.removeToken();\r\n  }\r\n\r\n  public getPayload(): any {\r\n    return this.shared.getPayload();\r\n  }\r\n\r\n  public setStorageType(type: StorageType): boolean {\r\n    return this.shared.setStorageType(type);\r\n  }\r\n\r\n  public getExpirationDate(): Date | null {\r\n    return this.shared.getExpirationDate();\r\n  }\r\n}\r\n","import {Injectable} from '@angular/core';\nimport {Observable, of, throwError} from 'rxjs';\nimport {AuthService} from './auth.service';\nimport {StorageService} from './storage-service';\nimport {buildQueryString, expand, flatten, getWindowOrigin, parseQueryString, staticify} from './utils';\nimport {IHierarchicalObject, IOauth1Options, IOauth2Options, IOauthOptions, ISimpleObject} from './config-interfaces';\nimport {OauthService} from './oauth.service';\nimport {tap} from 'rxjs/operators';\nimport {SharedService} from './shared.service';\n\n@Injectable()\nexport class RedirectService {\n\n  constructor(private authService: AuthService, private storage: StorageService,\n              private oauth: OauthService, private shared: SharedService) {\n  }\n\n  public go(url: string, options: IOauth2Options | IOauth1Options,\n            authorizationData: ISimpleObject, userData: IHierarchicalObject): Observable<IHierarchicalObject> {\n    if (window) {\n      const qs = buildQueryString(flatten(staticify({options, authorizationData, userData})));\n      this.storage.set('ng2-ui-auth-REDIRECT', qs, '');\n      window.open(url, '_self');\n      return of({});\n    }\n    return throwError('Failed to redirect');\n  }\n\n  public isRedirect(): boolean {\n    const options = this.storage.get('ng2-ui-auth-REDIRECT');\n    if (options) {\n      const w: Window = window;\n      const windowOrigin = getWindowOrigin(w);\n      const optionsObject = expand(parseQueryString(options)) as IOauth2Options;\n      const redirectUri = optionsObject.redirectUri;\n      return redirectUri != null && windowOrigin != null\n        && (redirectUri.indexOf(windowOrigin) === 0 || windowOrigin.indexOf(redirectUri) === 0)\n        && (w.location.search != null || w.location.hash != null);\n    }\n  }\n\n  public handleRedirect(): Observable<IHierarchicalObject> {\n    const options = this.storage.get('ng2-ui-auth-REDIRECT');\n    if (options) {\n      const w: Window = window;\n      const windowOrigin = getWindowOrigin(w);\n      const data = expand(parseQueryString(options));\n      const optionsObject = data['options'] as IOauthOptions;\n      const authorizationData = data['authorizationData'] as ISimpleObject;\n      const userData = data['userData'] as IHierarchicalObject;\n      const redirectUri = optionsObject.redirectUri;\n      if (redirectUri != null && windowOrigin != null\n        && (redirectUri.indexOf(windowOrigin) === 0 || windowOrigin.indexOf(redirectUri) === 0)\n        && (w.location.search != null || w.location.hash != null)) {\n        const queryParams = w.location.search.substring(1).replace(/\\/$/, '');\n        const hashParams = w.location.hash.substring(1).replace(/[\\/$]/, '');\n        const hash = parseQueryString(hashParams);\n        const qs = parseQueryString(queryParams);\n        const allParams = {...qs, ...hash};\n        if (allParams.error) {\n          throw throwError(allParams.error);\n        } else {\n          return this.oauth.getProvider(optionsObject)\n            .exchangeForToken(optionsObject, authorizationData, allParams, userData)\n            .pipe(tap(response => {\n              this.shared.setToken(response);\n              this.storage.remove('ng2-ui-auth-REDIRECT');\n            }));\n        }\n      }\n      return throwError('Not at valid redirect URI');\n    }\n    return throwError('No stored options for redirect');\n  }\n\n}\n","import {HttpClient} from '@angular/common/http';\r\nimport {Injectable} from '@angular/core';\r\nimport {Observable} from 'rxjs';\r\nimport {map, mergeMap, switchMap, tap} from 'rxjs/operators';\r\nimport {IHierarchicalObject, IOauth1Options, ISimpleObject} from './config-interfaces';\r\nimport {ConfigService} from './config.service';\r\nimport {IOauthService} from './oauth-service';\r\nimport {PopupService} from './popup.service';\r\nimport {buildQueryString, joinUrl} from './utils';\r\nimport {RedirectService} from './redirect.service';\r\n\r\n@Injectable()\r\nexport class Oauth1Service implements IOauthService<IOauth1Options> {\r\n  constructor(private http: HttpClient, private popup: PopupService, private config: ConfigService, private redirect: RedirectService) {\r\n  }\r\n\r\n  open(oauthOptions: IOauth1Options, userData: IHierarchicalObject): Observable<IHierarchicalObject> {\r\n    const serverUrl = this.config.options.baseUrl ? joinUrl(this.config.options.baseUrl, oauthOptions.url) : oauthOptions.url;\r\n    if (oauthOptions.doRedirect) {\r\n      return this.http.post<ISimpleObject>(serverUrl, oauthOptions)\r\n        .pipe(mergeMap(authorizationData =>\r\n          this.redirect.go([oauthOptions.authorizationEndpoint, buildQueryString(authorizationData)].join('?'),\r\n            oauthOptions, authorizationData, userData)));\r\n    }\r\n    return this.popup.open('about:blank', oauthOptions, this.config.options.cordova).pipe(\r\n      switchMap(popupWindow =>\r\n        this.http.post<ISimpleObject>(serverUrl, oauthOptions).pipe(\r\n          tap(authorizationData =>\r\n            popupWindow\r\n              ? popupWindow.location.replace([oauthOptions.authorizationEndpoint, buildQueryString(authorizationData)].join('?'))\r\n              : undefined\r\n          ),\r\n          switchMap(authorizationData =>\r\n            this.popup\r\n              .waitForClose(popupWindow, this.config.options.cordova, oauthOptions.redirectUri)\r\n              .pipe(map(oauthData => ({authorizationData, oauthData})))\r\n          )\r\n        )\r\n      ),\r\n      switchMap(({authorizationData, oauthData}) => this.exchangeForToken(oauthOptions, authorizationData, oauthData, userData))\r\n    );\r\n  }\r\n\r\n  exchangeForToken(oauthOptions: IOauth1Options,\r\n                   authorizationData: ISimpleObject,\r\n                   oauthData: ISimpleObject,\r\n                   userData: IHierarchicalObject): Observable<IHierarchicalObject> {\r\n    const body = {oauthOptions, authorizationData, oauthData, userData};\r\n    const {withCredentials, baseUrl} = this.config.options;\r\n    const {method = 'POST', url} = oauthOptions;\r\n    const exchangeForTokenUrl = baseUrl ? joinUrl(baseUrl, url) : url;\r\n    return this.http.request<IHierarchicalObject>(method, exchangeForTokenUrl, {body, withCredentials});\r\n  }\r\n}\r\n","import {HttpClient} from '@angular/common/http';\r\nimport {Injectable} from '@angular/core';\r\nimport {EMPTY, Observable, of, throwError} from 'rxjs';\r\nimport {switchMap} from 'rxjs/operators';\r\nimport {IHierarchicalObject, IOauth2Options, ISimpleObject} from './config-interfaces';\r\nimport {ConfigService} from './config.service';\r\nimport {IOauthService} from './oauth-service';\r\nimport {PopupService} from './popup.service';\r\nimport {buildQueryString, expand, getWindowOrigin, joinUrl} from './utils';\r\nimport {RedirectService} from './redirect.service';\r\n\r\n@Injectable()\r\nexport class Oauth2Service implements IOauthService<IOauth2Options> {\r\n  constructor(private http: HttpClient, private popup: PopupService, private config: ConfigService, private redirect: RedirectService) {\r\n  }\r\n\r\n  open(oauthOptions: IOauth2Options, userData: IHierarchicalObject): Observable<IHierarchicalObject> {\r\n    const authorizationData = this.getAuthorizationData(oauthOptions);\r\n    const url = [oauthOptions.authorizationEndpoint, buildQueryString(authorizationData)].join('?');\r\n    if (oauthOptions.doRedirect) {\r\n      return this.redirect.go(url, oauthOptions, authorizationData, userData);\r\n    }\r\n    return this.popup.open(url, oauthOptions, this.config.options.cordova).pipe(\r\n      switchMap((window: Window) =>\r\n        this.popup.waitForClose(window, this.config.options.cordova, oauthOptions.redirectUri)\r\n      ),\r\n      switchMap((oauthData: ISimpleObject) => {\r\n        // when no server URL provided, return popup params as-is.\r\n        // this is for a scenario when someone wishes to opt out from\r\n        // satellizer's magic by doing authorization code exchange and\r\n        // saving a token manually.\r\n        if (oauthOptions.responseType === 'token' || !oauthOptions.url) {\r\n          return of(expand(oauthData));\r\n        }\r\n\r\n        if (oauthData.state && oauthData.state !== authorizationData.state) {\r\n          return throwError('OAuth \"state\" mismatch');\r\n        }\r\n        return this.exchangeForToken(oauthOptions, authorizationData, oauthData, userData);\r\n      })\r\n    );\r\n  }\r\n\r\n  exchangeForToken(options: IOauth2Options,\r\n                   authorizationData: ISimpleObject,\r\n                   oauthData: ISimpleObject,\r\n                   userData: IHierarchicalObject): Observable<IHierarchicalObject> {\r\n    const body = {authorizationData, oauthData, userData};\r\n    const {baseUrl, withCredentials} = this.config.options;\r\n    const {url, method = 'POST'} = options;\r\n    const exchangeForTokenUrl = baseUrl ? joinUrl(baseUrl, url) : url;\r\n    return this.http.request<IHierarchicalObject>(method, exchangeForTokenUrl, {body, withCredentials});\r\n  }\r\n\r\n  private getAuthorizationData(options: IOauth2Options): ISimpleObject {\r\n    const {\r\n      responseType = 'code',\r\n      clientId,\r\n      redirectUri = getWindowOrigin() || '',\r\n      scopeDelimiter = ',',\r\n      scope,\r\n      state,\r\n      additionalUrlParams\r\n    } = options;\r\n    const resolvedState = typeof state === 'function' ? state() : state;\r\n    return [\r\n      ['response_type', responseType],\r\n      ['client_id', clientId],\r\n      ['redirect_uri', redirectUri],\r\n      ...(state ? [['state', resolvedState]] : []),\r\n      ...(scope ? [['scope', scope.join(scopeDelimiter)]] : []),\r\n      ...(additionalUrlParams\r\n        ? Object.keys(additionalUrlParams).map(key => {\r\n          const value: string | (() => string) | null | undefined = (additionalUrlParams as any)[key];\r\n          if (typeof value === 'string') {\r\n            return [key, value];\r\n          } else if (typeof value === 'function') {\r\n            return [key, value()];\r\n          } else if (value === null) {\r\n            return [key, ''];\r\n          }\r\n          return ['', ''];\r\n        })\r\n        : [])\r\n    ]\r\n      .filter(_ => !!_[0])\r\n      .reduce((acc, next) => ({...acc, [next[0]]: next[1]}), {} as ISimpleObject);\r\n  }\r\n}\r\n","import {Injectable, Injector} from '@angular/core';\r\nimport {joinUrl} from './utils';\r\nimport {tap} from 'rxjs/operators';\r\nimport {Oauth1Service} from './oauth1.service';\r\nimport {Oauth2Service} from './oauth2.service';\r\nimport {Observable} from 'rxjs';\r\nimport {PopupService} from './popup.service';\r\nimport {ConfigService} from './config.service';\r\nimport {SharedService} from './shared.service';\r\nimport {HttpClient} from '@angular/common/http';\r\nimport {IOauthService} from './oauth-service';\r\nimport {IHierarchicalObject, IOauthOptions} from './config-interfaces';\r\nimport {RedirectService} from './redirect.service';\r\n\r\n@Injectable()\r\nexport class OauthService {\r\n  readonly depProviders = [\r\n    {provide: HttpClient, useValue: this.http},\r\n    {provide: PopupService, useValue: this.popup},\r\n    {provide: ConfigService, useValue: this.config}\r\n  ];\r\n  readonly deps = [HttpClient, PopupService, ConfigService];\r\n\r\n  constructor(private http: HttpClient, private shared: SharedService,\r\n              private config: ConfigService, private popup: PopupService) {\r\n  }\r\n\r\n  public authenticate(name: string, userData?: IHierarchicalObject): Observable<IHierarchicalObject> {\r\n    const provider = this.getProvider(name);\r\n\r\n    return provider.open(this.config.options.providers[name], userData || {}).pipe(\r\n      tap(response => {\r\n        // this is for a scenario when someone wishes to opt out from\r\n        // satellizer's magic by doing authorization code exchange and\r\n        // saving a token manually.\r\n        if (this.config.options.providers[name].url) {\r\n          this.shared.setToken(response);\r\n        }\r\n      })\r\n    );\r\n  }\r\n\r\n  public getProvider(id: string | IOauthOptions): IOauthService {\r\n    const type = typeof (id) === 'string' ? this.config.options.providers[id as string].oauthType : (id as IOauthOptions)['oauthType'];\r\n    const provider: IOauthService =\r\n      type === '1.0'\r\n        ? Injector.create([...this.depProviders, {provide: Oauth1Service, deps: this.deps}]).get(Oauth1Service)\r\n        : Injector.create([...this.depProviders, {provide: Oauth2Service, deps: this.deps}]).get(Oauth2Service);\r\n    return provider;\r\n  }\r\n\r\n  public unlink<T>(provider: string, url = joinUrl(this.config.options.baseUrl, this.config.options.unlinkUrl), method = 'POST') {\r\n    return this.http.request<T>(method, url, {body: {provider}});\r\n  }\r\n}\r\n","import {Directive, EventEmitter, OnInit, Output} from '@angular/core';\nimport {RedirectService} from './redirect.service';\nimport {IHierarchicalObject} from './config-interfaces';\n\n@Directive({\n  selector: '[authRedirect]'\n})\nexport class RedirectDirective implements OnInit {\n  @Output() onLogin = new EventEmitter<IHierarchicalObject>();\n  @Output() onLoginError = new EventEmitter<any>();\n\n  constructor(private redirect: RedirectService) {\n  }\n\n  ngOnInit(): void {\n    if (this.redirect.isRedirect()) {\n      this.redirect.handleRedirect()\n        .subscribe({\n          next: value => this.onLogin.emit(value),\n          error: err => this.onLoginError.emit(err)\n        });\n    }\n  }\n\n}\n","import {NgModule, ModuleWithProviders} from '@angular/core';\r\nimport {HttpClientModule, HTTP_INTERCEPTORS} from '@angular/common/http';\r\nimport {IPartialConfigOptions} from './config-interfaces';\r\nimport {CONFIG_OPTIONS, ConfigService} from './config.service';\r\nimport {StorageService} from './storage-service';\r\nimport {BrowserStorageService} from './browser-storage.service';\r\nimport {SharedService} from './shared.service';\r\nimport {JwtInterceptor} from './interceptor.service';\r\nimport {OauthService} from './oauth.service';\r\nimport {HttpClient} from '@angular/common/http';\r\nimport {PopupService} from './popup.service';\r\nimport {LocalService} from './local.service';\r\nimport {AuthService} from './auth.service';\r\nimport {RedirectDirective} from './redirect.directive';\r\nimport {RedirectService} from './redirect.service';\r\n\r\n@NgModule({\r\n  imports: [HttpClientModule],\r\n  declarations: [RedirectDirective],\r\n  exports: []\r\n})\r\nexport class Ng2UiAuthModule {\r\n  static forRoot(configOptions: IPartialConfigOptions = {}, defaultJwtInterceptor = true): ModuleWithProviders<Ng2UiAuthModule> {\r\n    return {\r\n      ngModule: Ng2UiAuthModule,\r\n      providers: [\r\n        {provide: CONFIG_OPTIONS, useValue: configOptions},\r\n        {provide: ConfigService, useClass: ConfigService, deps: [CONFIG_OPTIONS]},\r\n        {provide: StorageService, useClass: BrowserStorageService, deps: [ConfigService]},\r\n        {provide: SharedService, useClass: SharedService, deps: [StorageService, ConfigService]},\r\n        {provide: LocalService, useClass: LocalService, deps: [HttpClient, SharedService, ConfigService]},\r\n        {provide: PopupService, useClass: PopupService, deps: [ConfigService]},\r\n        {provide: OauthService, useClass: OauthService, deps: [HttpClient, SharedService, ConfigService, PopupService]},\r\n        {provide: AuthService, useClass: AuthService, deps: [SharedService, LocalService, OauthService]},\r\n        {provide: RedirectService, useClass: RedirectService, deps: [AuthService, StorageService, OauthService, SharedService]},\r\n        ...(defaultJwtInterceptor\r\n          ? [{provide: HTTP_INTERCEPTORS, useClass: JwtInterceptor, multi: true, deps: [SharedService, ConfigService]}]\r\n          : [])\r\n      ]\r\n    };\r\n  }\r\n}\r\n"]}